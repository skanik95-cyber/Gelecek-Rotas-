<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gelecek Rotası - ABKÖ Meslek Keşif Platformu</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiNGRkQ3MDAiLz4KPHN2ZyB4PSI2IiB5PSI2IiB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSI+CjxwYXRoIGQ9Ik0xMCAyTDEwLjkgOC4yNkwxNiA5TDEyLjUgMTQuMjZMMTMuNSAyMEwxMCAxN0w2LjUgMjBMNy41IDE0LjI2TDQgOUw5LjUgOC4yNkwxMCAyWiIgZmlsbD0iIzRCMDA4MiIvPgo8L3N2Zz4KPC9zdmc+Cg==">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- 360 VR Video Player Libraries -->
    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style_new.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="showPage('home')">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNGRkQ3MDAiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSI+CjxwYXRoIGQ9Ik0xMiAyTDEzLjA5IDguMjZMMjAgOUwxNC43NCAxNC4yNkwxNiAyMkwxMiAxOEw4IDIyTDkuMjYgMTQuMjZMNCA5TDEwLjkxIDguMjZMMTIgMloiIGZpbGw9IiM0QjAwODIiLz4KPC9zdmc+Cjwvc3ZnPgo=" alt="Gelecek Rotası" class="me-2">
                <span class="brand-text">Gelecek Rotası</span>
            </a>
            
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="#" onclick="showPage('home')">Anasayfa</a>
                <a class="nav-link" href="#" onclick="showPage('about')">Hakkında</a>
                <a class="nav-link d-none" href="#" id="nav-advisor-link" onclick="showPage('advisor-dashboard')">Danışman Paneli</a>
                <div class="nav-icons">
                    <i class="fas fa-th nav-icon"></i>
                </div>
                <div class="nav-auth ms-3">
                    <span class="nav-user d-none" id="nav-user">
                        <i class="fas fa-user-circle me-2"></i>
                        <span id="nav-username"></span>
                    </span>
                    <button class="btn btn-sm btn-outline-light me-2" id="nav-login-btn" type="button">
                        Giriş
                    </button>
                    <button class="btn btn-sm btn-warning me-2" id="nav-register-btn" type="button">
                        Kayıt Ol
                    </button>
                    <button class="btn btn-sm btn-outline-light d-none" id="nav-logout-btn" type="button">
                        Çıkış
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <div class="main-container">
        
        <!-- Home Page -->
        <section id="home-page" class="page-section active">
            <div class="container">
                <div class="row align-items-center min-vh-100">
                    <div class="col-lg-6">
                        <div class="hero-content">
                            <h1 class="hero-title">GELECEK ROTASINA HOŞGELDİN</h1>
                            <p class="hero-subtitle">
                                Kendi yeteneklerine ve ilgi alanlarına en uygun meslekleri keşfetmeye hazır mısın?
                            </p>
                            <button class="btn btn-primary btn-hero" onclick="showPage('action-select')">
                                <i class="fas fa-play me-2"></i>Hadi Başlayalım!
                            </button>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="hero-illustration">
                            <div class="space-scene">
                                <div class="planet planet-1"></div>
                                <div class="planet planet-2"></div>
                                <div class="astronaut"></div>
                                <div class="stars"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Action Selection Page -->
        <section id="action-select-page" class="page-section">
            <div class="container">
                <div class="row justify-content-center min-vh-100 align-items-center">
                    <div class="col-lg-8 text-center">
                        <h1 class="page-title">NE YAPMAK İSTERSİN?</h1>
                        
                        <div class="action-buttons">
                            <div class="action-card" onclick="showPage('test')">
                                <div class="action-icon">
                                    <i class="fas fa-clipboard-list"></i>
                                </div>
                                <h3>MESLEK TESTİNİ BAŞLAT</h3>
                            </div>
                            
                            <div class="action-card" onclick="showPage('careers')">
                                <div class="action-icon">
                                    <i class="fas fa-vr-cardboard"></i>
                                </div>
                                <h3>MESLEKLERİ İNCELE</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Test Page -->
        <section id="test-page" class="page-section">
            <div class="container">
                <div class="row justify-content-center min-vh-100">
                    <div class="col-lg-8">
                        <div class="test-header text-center mb-4">
                            <h1 class="page-title">TEST SAYFALARI</h1>
                            <div class="progress-container">
                                <div class="progress">
                                    <div class="progress-bar" id="test-progress" style="width: 0%"></div>
                                </div>
                                <span class="progress-text" id="progress-text">1 / 170</span>
                            </div>
                        </div>
                        
                        <div class="test-content">
                            <div class="question-card">
                                <h3 class="question-text" id="question-text">Soru yükleniyor...</h3>
                                
                                <div class="answer-options">
                                    <button class="answer-btn" data-value="1">
                                        <span class="answer-number">1</span>
                                        <span class="answer-text">Hiç Katılmıyorum</span>
                                    </button>
                                    <button class="answer-btn" data-value="2">
                                        <span class="answer-number">2</span>
                                        <span class="answer-text">Katılmıyorum</span>
                                    </button>
                                    <button class="answer-btn" data-value="3">
                                        <span class="answer-number">3</span>
                                        <span class="answer-text">Katılıyorum</span>
                                    </button>
                                    <button class="answer-btn" data-value="4">
                                        <span class="answer-number">4</span>
                                        <span class="answer-text">Tamamen Katılıyorum</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="test-controls">
                                <button class="btn btn-outline-light" onclick="fillRandomly()">
                                    <i class="fas fa-random me-2"></i>Rastgele Doldur
                                </button>
                                <button class="btn btn-outline-light" onclick="resetTest()">
                                    <i class="fas fa-redo me-2"></i>Testi Sıfırla
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Results Page -->
        <section id="results-page" class="page-section">
            <div class="container">
                <div class="row min-vh-100">
                    <div class="col-12">
                        <div class="results-header text-center mb-5">
                            <h1 class="page-title">TEST SONUÇLARINA GÖRE SANA UYGUN MESLEKLER</h1>
                            <button class="btn btn-primary btn-lg mt-3" onclick="showPage('vr-explore')">
                                Bu meslekleri VR ile keşfet
                            </button>
                        </div>
                        
                        <!-- Radar Chart -->
                        <div class="row mb-5">
                            <div class="col-lg-6">
                                <div class="chart-container">
                                    <canvas id="radarChart"></canvas>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="top-areas">
                                    <h3>En Güçlü Alanların</h3>
                                    <div id="top-areas-list"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Career Cards -->
                        <div class="career-grid" id="career-results">
                            <!-- Career cards will be populated here -->
                        </div>
                        
                        <div class="text-center mt-4">
                            <button class="btn btn-outline-light me-3" onclick="showPage('test')">
                                <i class="fas fa-redo me-2"></i>Testi Tekrar Çöz
                            </button>
                            <button class="btn btn-outline-light" onclick="showPage('home')">
                                <i class="fas fa-home me-2"></i>Ana Sayfaya Dön
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VR Explore Page -->
        <section id="vr-explore-page" class="page-section">
            <div class="container">
                <div class="row justify-content-center min-vh-100 align-items-center">
                    <div class="col-lg-8 text-center">
                        <h1 class="page-title">VR İLE MESLEK KEŞFİ</h1>
                        <p class="page-subtitle">Meslekleri sanal gerçeklik ile deneyimle!</p>
                        
                        <div class="vr-career-grid" id="vr-career-list">
                            <!-- VR career options will be populated here -->
                        </div>
                        
                        <div class="mt-4">
                            <button class="btn btn-outline-light me-3" onclick="showPage('results')">
                                <i class="fas fa-arrow-left me-2"></i>Sonuçlara Dön
                            </button>
                            <button class="btn btn-outline-light" onclick="showPage('home')">
                                <i class="fas fa-home me-2"></i>Ana Sayfaya Dön
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VR Simulation Pages (Dynamic) -->
        <section id="vr-simulation-page" class="page-section">
            <div class="container">
                <div class="row min-vh-100">
                    <div class="col-12">
                        <div class="simulation-header text-center mb-4">
                            <h1 class="simulation-title" id="simulation-title">MESLEK SİMÜLASYONU</h1>
                        </div>
                        
                        <div class="row justify-content-center">
                            <div class="col-lg-10">
                                <!-- 360 VR Video Player Container -->
                                <div class="vr-video-container" id="vr-video-container">
                                    <div class="vr-loading">
                                        <div class="spinner"></div>
                                        <p>360° VR Deneyimi Yükleniyor...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <button class="btn btn-warning me-3" onclick="showPage('vr-explore')">
                                <i class="fas fa-arrow-left me-2"></i>VR Ana Sayfaya Dön
                            </button>
                            <button class="btn btn-warning" onclick="showPage('careers')">
                                <i class="fas fa-briefcase me-2"></i>Diğer Meslekleri Gör
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Careers Page -->
        <section id="careers-page" class="page-section">
            <div class="container">
                <div class="row min-vh-100">
                    <div class="col-12">
                        <div class="text-center mb-5">
                            <h1 class="page-title">MESLEKLER</h1>
                            <p class="page-subtitle">Tüm meslekleri keşfet ve VR ile deneyimle</p>
                        </div>
                        
                        <div class="career-grid" id="all-careers">
                            <!-- All career cards will be populated here -->
                        </div>
                        
                        <div class="text-center mt-4">
                            <button class="btn btn-outline-light" onclick="showPage('home')">
                                <i class="fas fa-home me-2"></i>Ana Sayfaya Dön
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Page -->
        <section id="about-page" class="page-section">
            <div class="container">
                <div class="row align-items-center min-vh-100">
                    <div class="col-lg-6">
                        <div class="about-content">
                            <h1 class="page-title">HAKKINDA</h1>
                            <p class="about-text">
                                Gelecek Rotası, öğrencilerin ilgi, yetenek ve değerlerine uygun meslekleri keşfetmelerine yardımcı olmak için tasarlanmış bir dijital rehberlik platformudur. Kullanıcılar, kişisel özelliklerini belirlemek amacıyla bilimsel testler çözer ve bu testler sonucunda kendilerine uygun meslek önerileri alırlar. Ayrıca önerilen mesleklerin sanal gerçeklik (VR) ortamında hazırlanan deneyimlerle simülasyonlarıyla mesleklerin işleyişini yakından görebilirler.
                            </p>
                            <p class="about-text">
                                Bu sayede öğrenciler, meslekleri gerçekçi bir ortamda tanıma fırsatı elde ederek bilgi sahibi olurlar.
                            </p>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="about-illustration">
                            <div class="vr-character">
                                <div class="vr-headset"></div>
                                <div class="character-body"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Auth Page -->
        <section id="auth-page" class="page-section">
            <div class="container">
                <div class="row justify-content-center min-vh-100 align-items-center">
                    <div class="col-lg-6">
                        <div class="auth-card">
                            <div class="text-center mb-4">
                                <h1 class="page-title">HESABINIZA GİRİN</h1>
                                <p class="page-subtitle">Özel içeriklere erişmek için giriş yapın veya kayıt olun.</p>
                            </div>
                            <div class="auth-tabs">
                                <button class="auth-tab active" data-auth-tab="login" type="button">Giriş Yap</button>
                                <button class="auth-tab" data-auth-tab="register" type="button">Kayıt Ol</button>
                            </div>
                            <div class="auth-message" id="auth-message" role="status" aria-live="polite"></div>
                            <form id="login-form" class="auth-form active">
                                <div class="mb-3">
                                    <label for="login-username" class="form-label">Kullanıcı Adı</label>
                                    <input type="text" class="form-control" id="login-username" required autocomplete="username">
                                </div>
                                <div class="mb-3">
                                    <label for="login-password" class="form-label">Şifre</label>
                                    <input type="password" class="form-control" id="login-password" required autocomplete="current-password">
                                </div>
                                <button class="btn btn-primary w-100" type="submit">Giriş Yap</button>
                            </form>
                            <form id="register-form" class="auth-form">
                                <div class="mb-3">
                                    <label for="register-username" class="form-label">Kullanıcı Adı</label>
                                    <input type="text" class="form-control" id="register-username" required autocomplete="username">
                                </div>
                                <div class="mb-3">
                                    <label for="register-password" class="form-label">Şifre</label>
                                    <input type="password" class="form-control" id="register-password" required minlength="8" autocomplete="new-password">
                                    <small class="form-text text-light">En az 8 karakter girin.</small>
                                </div>
                                <button class="btn btn-warning w-100" type="submit">Hesap Oluştur</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Advisor Dashboard Page -->
        <section id="advisor-dashboard-page" class="page-section">
            <div class="container">
                <div class="row min-vh-100">
                    <div class="col-12">
                        <div class="text-center mb-5">
                            <h1 class="page-title">DANIŞMAN PANELİ</h1>
                            <p class="page-subtitle">Atanmış öğrencileri inceleyin ve test sonuçlarını takip edin.</p>
                        </div>
                        <div class="advisor-layout">
                            <div class="advisor-card">
                                <h3 class="advisor-card-title">Öğrenciler</h3>
                                <div class="advisor-table-wrapper">
                                    <table class="advisor-table">
                                        <thead>
                                            <tr>
                                                <th>Öğrenci</th>
                                                <th>Son Güncelleme</th>
                                                <th>Test Sayısı</th>
                                            </tr>
                                        </thead>
                                        <tbody id="advisor-student-list">
                                            <tr>
                                                <td colspan="3">Öğrenciler yükleniyor...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="advisor-card">
                                <h3 class="advisor-card-title">Öğrenci Detayları</h3>
                                <div class="advisor-student-details">
                                    <div class="advisor-student-header">
                                        <div>
                                            <h4 id="advisor-student-name">Bir öğrenci seçin</h4>
                                            <p class="advisor-muted" id="advisor-student-meta">Test sonuçlarını görmek için tablodan seçim yapın.</p>
                                        </div>
                                    </div>
                                    <div class="advisor-chart-container">
                                        <canvas id="advisor-progress-chart"></canvas>
                                    </div>
                                    <div class="advisor-table-wrapper mt-4">
                                        <table class="advisor-table">
                                            <thead>
                                                <tr>
                                                    <th>Tarih</th>
                                                    <th>En Güçlü Alanlar</th>
                                                    <th>Önerilen Meslek Sayısı</th>
                                                </tr>
                                            </thead>
                                            <tbody id="advisor-results-list">
                                                <tr>
                                                    <td colspan="3">Henüz veri yok.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <button class="btn btn-outline-light" onclick="showPage('home')">
                                <i class="fas fa-home me-2"></i>Ana Sayfaya Dön
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Career Data (embedded to avoid CORS issues)
        const careerData = [
            {
                name: "Doktor",
                description: "Hastalıkları teşhis ve tedavi eden, insan sağlığını koruyan tıp uzmanı.",
                requirements: {
                    "Fen Bilimleri İlgisi": 3.0,
                    "Sayısal Yetenek": 3.0,
                    "Göz-El Koordinasyonu": 3.0,
                    "Sosyal Yardım İlgisi": 3.5
                },
                vr_image: "images/doctor_simulation.png",
                hasVRVideo: true,
                vrVideoFile: "https://youtu.be/jeBFt57HlZ4?si=6osOSkJ8gGwqF3dx",
                vrDescription: "Ameliyathane ortamında 360° tıbbi müdahale deneyimi."
            },
            {
                name: "Öğretmen",
                description: "Öğrencilere bilgi ve beceri kazandıran, eğitim süreçlerini yöneten, pedagojik formasyona sahip kişi.",
                requirements: {
                    "Sözel Yetenek": 3.5,
                    "Sosyal Bilimler İlgisi": 3.5,
                    "Sosyal Yardım İlgisi": 2.5,
                    "İkna İlgisi": 2.5
                },
                vr_image: "images/teacher_simulation.png",
                hasVRVideo: true,
                vrVideoFile: "https://youtu.be/CSY0pHI8h34?si=sRjAYqNdp7R_yJwx",
                vrDescription: "Öğretmenlik mesleğini 360° VR video ile deneyimleyin."
            },
            {
                name: "Veteriner",
                description: "Hayvan sağlığını koruyan, tedavi eden klinik ve bakım uzmanı.",
                requirements: {
                    "Fen Bilimleri İlgisi": 4.0,
                    "Sayısal Yetenek": 3.0,
                    "Sosyal Yardım İlgisi": 3.5,
                    "Ziraat İlgisi": 3.0
                },
                vr_image: "images/veterinary_clinic_simulation.png",
                hasVRVideo: true,
                vrVideoFile: "https://www.youtube.com/watch?v=EGDXVQwOGf0",
                vrDescription: "360° hayvan muayenesi ve klinik deneyimi."
            },
            {
                name: "Hemşire",
                description: "Hastaların bakımını üstlenen, tedavi sürecini destekleyen sağlık profesyoneli.",
                requirements: {
                    "Sosyal Yardım İlgisi": 4.0,
                    "Fen Bilimleri İlgisi": 3.0,
                    "Göz-El Koordinasyonu": 3.0,
                    "Sözel Yetenek": 2.5
                },
                vr_image: "images/nurse_simulation.png",
                hasVRVideo: true,
                vrVideoFile: "https://www.youtube.com/watch?v=4--pyJLhlB0",
                vrDescription: "Hastane içinde 360° hemşirelik deneyimi."
            },
            {
                name: "Bilgisayar Grafik Teknikeri",
                description: "2D/3D grafikler, animasyonlar ve dijital tasarımlar oluşturan teknik uzman.",
                requirements: {
                    "Şekil-Uzay Yeteneği": 4.0,
                    "Güzel Sanatlar İlgisi": 3.5,
                    "Sayısal Yetenek": 3.0
                },
                vr_image: "images/graphic_technician_simulation.png",
                hasVRVideo: true,
                vrVideoFile: "https://www.youtube.com/watch?v=mw8y18D8GBM",
                vrDescription: "360° dijital grafik atölyesi deneyimi."
            },
            {
                name: "Astronot",
                description: "Uzay görevlerinde araştırmalar yapan ve uzay araçlarını kullanan uzman.",
                requirements: {
                    "Fen Bilimleri İlgisi": 3.5,
                    "Sayısal Yetenek": 3.5,
                    "Şekil-Uzay Yeteneği": 4.0,
                    "Mekanik İlgi": 3.5,
                    "Göz-El Koordinasyonu": 3.5,
                    "Yabancı Dil İlgisi": 3.0
                },
                vr_image: "images/astronaut_spacewalk_simulation.png",
                hasVRVideo: true,
                vrVideoFile: "https://www.youtube.com/watch?v=hEdzv7D4CbQ&t=5s",
                vrDescription: "Uluslararası Uzay İstasyonu'nda 360° uzay yürüyüşü deneyimi."
            },
            {
                name: "Bahçıvan",
                description: "Bitki yetiştirme, bahçe bakımı ve peyzaj işleriyle ilgilenen uzman.",
                requirements: {
                    "Ziraat İlgisi": 4.0,
                    "Göz-El Koordinasyonu": 2.5,
                    "İş Ayrıntıları İlgisi": 2.5
                },
                vr_image: "images/gardener_simulation.png",
                hasVRVideo: true,
                vrVideoFile: "https://www.youtube.com/watch?v=7fcds-B8czg&t=21s",
                vrDescription: "360° bitki yetiştirme ve bahçe bakım simülasyonu."
            },
            {
                name: "Ressam",
                description: "Duygularını ve düşüncelerini resim yoluyla ifade eden sanatçı.",
                requirements: {
                    "Güzel Sanatlar İlgisi": 4.0,
                    "Şekil-Uzay Yeteneği": 3.5,
                    "İş Ayrıntıları İlgisi": 3.0
                },
                vr_image: "images/painter_studio_simulation.png",
                hasVRVideo: true,
                vrVideoFile: "https://www.youtube.com/watch?v=pq2TwRNy_FU",
                vrDescription: "360° sanat atölyesi deneyimi."
            },
            {
                name: "İtfaiyeci",
                description: "Yangınlara müdahale eden, arama-kurtarma yapan kamu güvenliği çalışanı.",
                requirements: {
                    "Göz-El Koordinasyonu": 4.0,
                    "Mekanik İlgi": 3.0,
                    "Şekil-Uzay Yeteneği": 3.0,
                    "Sosyal Yardım İlgisi": 4.0
                },
                vr_image: "images/firefighter_rescue_simulation.png",
                hasVRVideo: true,
                vrVideoFile: "https://www.youtube.com/watch?v=W5njz511s1k",
                vrDescription: "itfaiye istasyonunda 360° deneyim"
            },
            {
                name: "Mekanik Mühendisi",
                description: "Makine sistemlerini tasarlayan, analiz eden ve geliştiren mühendislik uzmanı.",
                requirements: {
                    "Sayısal Yetenek": 4.0,
                    "Mekanik İlgi": 4.0,
                    "Şekil-Uzay Yeteneği": 3.5,
                    "Fen Bilimleri İlgisi": 3.5
                },
                vr_image: "images/mechanical_engineer_simulation.png",
                hasVRVideo: true,
                vrVideoFile: "https://youtu.be/npEv3YZLSMs?si=WgxbPI-jZpmNWH3N",
                vrDescription: "360° makine tasarım ve mühendislik uygulama ortamı."
            },
            {
                name: "Psikolojik Danışman",
                description: "Bireylerin duygusal, sosyal ve akademik gelişimini destekleyen, rehberlik hizmeti sunan uzman.",
                requirements: {
                    "Sözel Yetenek": 3.5,
                    "Sosyal Yardım İlgisi": 4.0,
                    "Sosyal Bilimler İlgisi": 3.5,
                    "İkna İlgisi": 3.0
                },
                vr_image: "",
                hasVRVideo: false,
                vrVideoFile: "",
                vrDescription: ""
            },
            {
                name: "Diş Hekimi",
                description: "Ağız ve diş sağlığı sorunlarını teşhis eden ve tedavi eden sağlık uzmanı.",
                requirements: {
                    "Göz-El Koordinasyonu": 4.0,
                    "Fen Bilimleri İlgisi": 3.5,
                    "Sayısal Yetenek": 3.0,
                    "İş Ayrıntıları İlgisi": 3.5
                },
                vr_image: "",
                hasVRVideo: false,
                vrVideoFile: "",
                vrDescription: ""
            },
            {
                name: "Polis Memuru",
                description: "Toplum güvenliğini sağlayan, suçları önleyen ve hukuku uygulayan kamu görevlisi.",
                requirements: {
                    "Göz-El Koordinasyonu": 3.5,
                    "Şekil-Uzay Yeteneği": 3.0,
                    "Sosyal Yardım İlgisi": 3.5,
                    "Mekanik İlgi": 2.5
                },
                vr_image: "",
                hasVRVideo: false,
                vrVideoFile: "",
                vrDescription: ""
            },
            {
                name: "Aşçı",
                description: "Yemek hazırlayan, mutfak düzenini sağlayan ve yaratıcı tarifler geliştiren mutfak profesyoneli.",
                requirements: {
                    "Göz-El Koordinasyonu": 3.0,
                    "İş Ayrıntıları İlgisi": 3.5,
                    "Güzel Sanatlar İlgisi": 2.5,
                    "Ziraat İlgisi": 2.0
                },
                vr_image: "",
                hasVRVideo: false,
                vrVideoFile: "",
                vrDescription: ""
            },
            {
                name: "Arkeolog",
                description: "Geçmiş uygarlıkların izlerini araştıran, kazı çalışmaları yapan bilim insanı.",
                requirements: {
                    "Sosyal Bilimler İlgisi": 4.0,
                    "Şekil-Uzay Yeteneği": 3.0,
                    "İş Ayrıntıları İlgisi": 3.0,
                    "Fen Bilimleri İlgisi": 2.5
                },
                vr_image: "",
                hasVRVideo: false,
                vrVideoFile: "",
                vrDescription: ""
            }
        ];
        
        // Global variables
        let questions = [];
        let answers = {};
        let currentQuestionIndex = 0;
        let careers = [];
        let currentSimulation = null;
        let testResults = null;
        
        // VR Video Player variables
        let vrScene, vrCamera, vrRenderer, vrControls;
        let videoTexture, videoMaterial, sphereGeometry, sphereMesh;
        let isPlaying = false;
        let videoElement = null;

        // ABKÖ Orijinal Yapısı - 4 Yetenek + 12 İlgi Alanı (Toplam 170 madde)
        const academicCategories = [
            // 4 YETENEK ALANI (44 madde)
            { name: "Sözel Yetenek", type: "yetenek", madde_sayisi: 12, questions: [] },
            { name: "Sayısal Yetenek", type: "yetenek", madde_sayisi: 10, questions: [] },
            { name: "Şekil-Uzay Yeteneği", type: "yetenek", madde_sayisi: 12, questions: [] },
            { name: "Göz-El Koordinasyonu", type: "yetenek", madde_sayisi: 10, questions: [] },
            
            // 12 İLGİ ALANI (126 madde)
            { name: "Fen Bilimleri İlgisi", type: "ilgi", madde_sayisi: 12, questions: [] },
            { name: "Sosyal Bilimler İlgisi", type: "ilgi", madde_sayisi: 11, questions: [] },
            { name: "İkna İlgisi", type: "ilgi", madde_sayisi: 11, questions: [] },
            { name: "Yabancı Dil İlgisi", type: "ilgi", madde_sayisi: 10, questions: [] },
            { name: "Ticaret İlgisi", type: "ilgi", madde_sayisi: 10, questions: [] },
            { name: "Ziraat İlgisi", type: "ilgi", madde_sayisi: 10, questions: [] },
            { name: "Mekanik İlgi", type: "ilgi", madde_sayisi: 10, questions: [] },
            { name: "İş Ayrıntıları İlgisi", type: "ilgi", madde_sayisi: 10, questions: [] },
            { name: "Edebiyat İlgisi", type: "ilgi", madde_sayisi: 10, questions: [] },
            { name: "Güzel Sanatlar İlgisi", type: "ilgi", madde_sayisi: 10, questions: [] },
            { name: "Müzik İlgisi", type: "ilgi", madde_sayisi: 10, questions: [] },
            { name: "Sosyal Yardım İlgisi", type: "ilgi", madde_sayisi: 10, questions: [] }
        ];

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const protectedPages = new Set([
            'action-select',
            'test',
            'results',
            'vr-explore',
            'vr-simulation',
            'careers',
            'advisor-dashboard'
        ]);

        let pendingPage = null;
        let firebaseApp = null;
        let auth = null;
        let db = null;
        let authUser = null;
        let authReady = false;
        let currentUserRole = 'student';

        function normalizeUsername(username) {
            return username.trim().toLowerCase();
        }

        function isAuthenticated() {
            return Boolean(authUser);
        }

        function getCurrentUser() {
            return authUser?.displayName || authUser?.email || '';
        }

        function isAdvisor() {
            return isAuthenticated() && currentUserRole === 'advisor';
        }

        function setAuthMessage(message, type = 'info') {
            const messageEl = document.getElementById('auth-message');
            if (!messageEl) return;
            messageEl.textContent = message;
            messageEl.className = `auth-message ${type}`;
        }

        function getRoleForUsername(username) {
            const normalized = normalizeUsername(username);
            if (normalized.startsWith('advisor-') || normalized.startsWith('danisman-')) {
                return 'advisor';
            }
            return 'student';
        }

        function formatAuthEmail(username) {
            const normalized = normalizeUsername(username);
            return `${normalized}@gelecekrotasi.local`;
        }

        function initializeFirebase() {
            if (!window.firebase) {
                console.error('Firebase SDK not available.');
                setAuthMessage('Kimlik doğrulama servisi yüklenemedi.', 'error');
                authReady = true;
                return;
            }
            if (firebaseConfig.apiKey === 'YOUR_API_KEY') {
                console.warn('Firebase config is not set.');
                setAuthMessage('Firebase yapılandırması eksik. Lütfen yapılandırmayı tamamlayın.', 'warning');
                authReady = true;
                return;
            }
            firebaseApp = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();

            auth.onAuthStateChanged(async user => {
                authUser = user;
                authReady = true;
                if (user) {
                    await syncUserProfile(user);
                }
                updateAuthUI();
                const activePage = getActivePageId();
                if (!user && protectedPages.has(activePage)) {
                    showPage('home');
                }
            });
        }

        async function syncUserProfile(user) {
            if (!db || !user) return;
            const userRef = db.collection('users').doc(user.uid);
            const snapshot = await userRef.get();
            if (snapshot.exists) {
                currentUserRole = snapshot.data().role || 'student';
                await userRef.set({
                    lastLoginAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                return;
            }
            currentUserRole = getRoleForUsername(user.displayName || user.email || '');
            await userRef.set({
                username: user.displayName || '',
                role: currentUserRole,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                lastLoginAt: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });
        }

        function showAuthTab(tabName) {
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.authTab === tabName);
            });
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.toggle('active', form.id === `${tabName}-form`);
            });
        }

        function updateAuthUI() {
            const loginBtn = document.getElementById('nav-login-btn');
            const registerBtn = document.getElementById('nav-register-btn');
            const logoutBtn = document.getElementById('nav-logout-btn');
            const userBadge = document.getElementById('nav-user');
            const usernameEl = document.getElementById('nav-username');
            const advisorLink = document.getElementById('nav-advisor-link');
            const loggedIn = isAuthenticated();

            if (loginBtn) loginBtn.classList.toggle('d-none', loggedIn);
            if (registerBtn) registerBtn.classList.toggle('d-none', loggedIn);
            if (logoutBtn) logoutBtn.classList.toggle('d-none', !loggedIn);
            if (userBadge) userBadge.classList.toggle('d-none', !loggedIn);
            if (usernameEl) usernameEl.textContent = loggedIn ? getCurrentUser() : '';
            if (advisorLink) advisorLink.classList.toggle('d-none', !isAdvisor());
        }

        async function registerUser(username, password) {
            if (!auth) {
                return { ok: false, message: 'Kimlik doğrulama servisi yüklenemedi.' };
            }
            const trimmedUsername = username.trim();
            if (trimmedUsername.length < 3) {
                return { ok: false, message: 'Kullanıcı adı en az 3 karakter olmalıdır.' };
            }
            if (password.length < 8) {
                return { ok: false, message: 'Şifre en az 8 karakter olmalıdır.' };
            }
            try {
                const email = formatAuthEmail(trimmedUsername);
                const credentials = await auth.createUserWithEmailAndPassword(email, password);
                await credentials.user.updateProfile({ displayName: trimmedUsername });
                currentUserRole = getRoleForUsername(trimmedUsername);
                await db.collection('users').doc(credentials.user.uid).set({
                    username: trimmedUsername,
                    role: currentUserRole,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastLoginAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                return { ok: true, message: 'Hesabınız oluşturuldu ve giriş yapıldı.' };
            } catch (error) {
                console.error('Registration error:', error);
                return { ok: false, message: 'Kayıt sırasında hata oluştu. Lütfen bilgilerinizi kontrol edin.' };
            }
        }

        async function loginUser(username, password) {
            if (!auth) {
                return { ok: false, message: 'Kimlik doğrulama servisi yüklenemedi.' };
            }
            try {
                const email = formatAuthEmail(username);
                const credentials = await auth.signInWithEmailAndPassword(email, password);
                await syncUserProfile(credentials.user);
                return { ok: true, message: 'Başarıyla giriş yaptınız.' };
            } catch (error) {
                console.error('Login error:', error);
                return { ok: false, message: 'Kullanıcı adı veya şifre hatalı.' };
            }
        }

        function getActivePageId() {
            const activeSection = document.querySelector('.page-section.active');
            if (!activeSection) return 'home';
            return activeSection.id.replace('-page', '');
        }

        function logoutUser() {
            if (!auth) return;
            auth.signOut();
        }

        function guardPageAccess(pageId) {
            if (protectedPages.has(pageId) && !isAuthenticated()) {
                pendingPage = pageId;
                if (!authReady) {
                    setAuthMessage('Kimlik doğrulama servisi yükleniyor...', 'info');
                } else {
                    setAuthMessage('Bu sayfaya erişmek için giriş yapmalısınız.', 'warning');
                }
                showAuthTab('login');
                return 'auth';
            }
            if (pageId === 'advisor-dashboard' && !isAdvisor()) {
                setAuthMessage('Bu sayfaya erişmek için danışman hesabı gerekir.', 'warning');
                return 'home';
            }
            if (pageId === 'auth' && isAuthenticated()) {
                setAuthMessage('Zaten giriş yaptınız.', 'success');
            }
            return pageId;
        }

        // Page navigation with smooth transitions
        function showPage(pageId) {
            const guardedPageId = guardPageAccess(pageId);
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show target page with animation
            setTimeout(() => {
                const targetPage = document.getElementById(guardedPageId + '-page');
                if (targetPage) {
                    targetPage.classList.add('active');
                    
                    // Initialize page-specific content
                    if (guardedPageId === 'test') {
                        initializeTest();
                    } else if (guardedPageId === 'careers') {
                        loadAllCareers();
                    } else if (guardedPageId === 'vr-explore') {
                        loadVRCareers();
                    } else if (guardedPageId === 'results') {
                        // Check if we have test results to display
                        if (window.testResults && window.testResults.categoryScores) {
                            displayExistingResults();
                        }
                    } else if (guardedPageId === 'advisor-dashboard') {
                        loadAdvisorDashboard();
                    } else if (guardedPageId === 'auth') {
                        const usernameInput = document.getElementById('login-username');
                        if (usernameInput) {
                            usernameInput.focus();
                        }
                    }
                }
            }, 100);
        }

        // Make functions globally accessible for HTML onclick attributes
        window.showPage = showPage;
        window.fillRandomly = fillRandomly;
        window.resetTest = resetTest;
        window.showCareerDetail = showCareerDetail;
        window.openVRSimulation = openVRSimulation;

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            // Suppress WebSocket errors from Live Preview
            window.addEventListener('error', function(e) {
                if (e.message.includes('WebSocket') || e.message.includes('favicon')) {
                    e.preventDefault();
                    return false;
                }
            });
            
            // Check if external libraries loaded
            checkLibraryAvailability();
            
            loadQuestions();
            loadCareers();
            loadAnswersFromStorage();
            
            // Add scroll animations
            addScrollAnimations();

            initializeFirebase();

            const loginBtn = document.getElementById('nav-login-btn');
            const registerBtn = document.getElementById('nav-register-btn');
            const logoutBtn = document.getElementById('nav-logout-btn');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');

            if (loginBtn) {
                loginBtn.addEventListener('click', () => {
                    pendingPage = null;
                    setAuthMessage('');
                    showAuthTab('login');
                    showPage('auth');
                });
            }

            if (registerBtn) {
                registerBtn.addEventListener('click', () => {
                    pendingPage = null;
                    setAuthMessage('');
                    showAuthTab('register');
                    showPage('auth');
                });
            }

            if (logoutBtn) {
                logoutBtn.addEventListener('click', logoutUser);
            }

            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    setAuthMessage('');
                    showAuthTab(tab.dataset.authTab);
                });
            });

            if (loginForm) {
                loginForm.addEventListener('submit', async event => {
                    event.preventDefault();
                    const username = document.getElementById('login-username').value;
                    const password = document.getElementById('login-password').value;
                    const result = await loginUser(username, password);
                    setAuthMessage(result.message, result.ok ? 'success' : 'error');
                    if (result.ok) {
                        updateAuthUI();
                        const nextPage = pendingPage || 'home';
                        pendingPage = null;
                        showPage(nextPage);
                    }
                });
            }

            if (registerForm) {
                registerForm.addEventListener('submit', async event => {
                    event.preventDefault();
                    const username = document.getElementById('register-username').value;
                    const password = document.getElementById('register-password').value;
                    const result = await registerUser(username, password);
                    setAuthMessage(result.message, result.ok ? 'success' : 'error');
                    if (result.ok) {
                        updateAuthUI();
                        const nextPage = pendingPage || 'home';
                        pendingPage = null;
                        showPage(nextPage);
                    }
                });
            }

            updateAuthUI();
        });

        // Check if external libraries are available
        function checkLibraryAvailability() {
            const libraries = {
                'Three.js': typeof THREE !== 'undefined',
                'Chart.js': typeof Chart !== 'undefined',
                'YouTube API': typeof YT !== 'undefined',
                'Firebase': typeof firebase !== 'undefined'
            };
            
            console.log('Library availability:', libraries);
            
            // Show warning if libraries are missing
            const missingLibraries = Object.entries(libraries)
                .filter(([, available]) => !available)
                .map(([name]) => name);
            
            if (missingLibraries.length > 0) {
                console.warn('Missing libraries:', missingLibraries);
                // Add a subtle warning to the page
                const warning = document.createElement('div');
                warning.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: rgba(255, 193, 7, 0.9);
                    color: #000;
                    padding: 10px 15px;
                    border-radius: 8px;
                    font-size: 0.8rem;
                    z-index: 1000;
                    max-width: 300px;
                `;
                warning.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Bazı özellikler yüklenemedi:</strong><br>
                    ${missingLibraries.join(', ')}<br>
                    <small>İnternet bağlantınızı kontrol edin</small>
                `;
                document.body.appendChild(warning);
                
                // Remove warning after 5 seconds
                setTimeout(() => {
                    if (warning.parentNode) {
                        warning.parentNode.removeChild(warning);
                    }
                }, 5000);
            }
        }

        // Load questions from JSON
        async function loadQuestions() {
            try {
                const response = await fetch('abko_questions.json');
                questions = await response.json();
                console.log(`${questions.length} soru yüklendi`);
            } catch (error) {
                console.error('Sorular yüklenirken hata:', error);
                // Fallback: Create sample questions if file not found
                createSampleQuestions();
            }
        }

        // Create sample questions if JSON file is not available
        function createSampleQuestions() {
            const questionsData = [
                { q: "Bir yazı yazarken, bir ödev yaparken, yazım (imla) kurallarına dikkat eder misiniz?", cat: "Sözel Yetenek" },
                { q: "Bir hikaye kitabını hızlı ve doğru okuyabilir misiniz?", cat: "Sözel Yetenek" },
                { q: "Çarpım tablosunu, bölme işlemini kolay öğrenebildiniz mi?", cat: "Sayısal Yetenek" },
                { q: "Birbirine çok benzeyen iki resmin arasındaki küçük farkları hemen görebilir misiniz?", cat: "Şekil-Uzay Yeteneği" },
                { q: "Kelimeleri doğru bir biçimde yazabiliyor ve söyleyebiliyor musunuz?", cat: "Sözel Yetenek" },
                { q: "Bir dairenin merkezini doğru bir biçimde tahmin ederek işaretleyebilir misiniz?", cat: "Göz-El Koordinasyonu" },
                { q: "İki çizgi arsında çok az bir uzunluk farkı olduğunda, bunu kolaylıkla algılayabilir misiniz?", cat: "Göz-El Koordinasyonu" },
                { q: "Bir parçayı bir kere okuduktan sonra hemen özetleyebiliyor musunuz?", cat: "Sözel Yetenek" },
                { q: "Dört işlemle akıldan, hızlı problem çözebilir misiniz?", cat: "Sayısal Yetenek" },
                { q: "Bir doğru parçasının kaç santimetre olduğunu doğru tahmin edebilir misiniz?", cat: "Sayısal Yetenek" },
                { q: "Yeni duyduğunuz kelimelerin anlamlarını öğrenmeye çalışır mısınız?", cat: "Sözel Yetenek" },
                { q: "Okuduğunuz bir parçada belirten fikirler arsında ilişki kurabiliyor musunuz?", cat: "Sözel Yetenek" },
                { q: "Bir matematik probleminin çözüm yolunu öğrendikten sonra, ona benzer problemleri çözebiliyor musunuz?", cat: "Sayısal Yetenek" },
                { q: "İlk defa gittiğiniz binada yönünüzü bulabiliyor musunuz?", cat: "Şekil-Uzay Yeteneği" },
                { q: "Bir defa başkaları ile birlikte gittiğiniz bir yeri, ikinci defa yalnız başına gittiğinizde, kolaylıkla bulabilir misiniz?", cat: "Şekil-Uzay Yeteneği" },
                { q: "Gelişigüzel parçaları ayrılmış bir şeklin veya cismin parçalarını eski yerlerine kolaylıkla yerleştirebilir misiniz?", cat: "Şekil-Uzay Yeteneği" },
                { q: "Bir makinanın şemasına bakarak makineyi kurabilir misiniz?", cat: "Mekanik İlgi" },
                { q: "Açılmış hali verilen geometrik bir cismin, kapandığı zaman açılacağı şekli göz önünde canlandırabilir misiniz?", cat: "Şekil-Uzay Yeteneği" },
                { q: "Bir konuda edindiğiniz bilgileri, kendi sözcüklerinizle başkalarına aktarabiliyor musunuz?", cat: "Sözel Yetenek" },
                { q: "Sizin düzeyinizde bir matematik kitabını okuyarak bir problemin çözüm yolunu bulabiliyor musunuz?", cat: "Sayısal Yetenek" },
                { q: "Boş zamanlarınızda, zevk için matematik problemleri çözmeye çalışır mısınız?", cat: "Sayısal Yetenek" },
                { q: "Bir konuyu söz ve yazı ile anlatırken, fikirleri doğru bir sıra ile verebiliyor musunuz?", cat: "Sözel Yetenek" },
                { q: "Matematik dersinde, özel bir yardım (ders) almadan başarılı olabiliyor musunuz?", cat: "Sayısal Yetenek" },
                { q: "Bir yazıdaki fikir ve ifade hatalarını kolaylıkla görebilir misiniz?", cat: "Sözel Yetenek" },
                { q: "Boş bir kesme şeker kutusu, kısa kenarlarından kesilip açılınca hangi yüzeyin nereye geleceğini gözönünde canlandırabilir misiniz?", cat: "Şekil-Uzay Yeteneği" },
                { q: "Öğrendiğiniz matematik kurallarına fen bilgisi derslerindeki problemlere uygulayabiliyor musunuz?", cat: "Sayısal Yetenek" },
                { q: "Bir kağıda, cetvel kullanmadan düzgün paralel çizgiler çizebiliyor musunuz?", cat: "Göz-El Koordinasyonu" },
                { q: "Karmaşık bir geometrik şeklin, sağa ve sola döndürülmesi ile alacağı durumu gözönünde canlandırabilir misiniz?", cat: "Şekil-Uzay Yeteneği" },
                { q: "Bir problemin, size öğretilen çözüm yollarından farklı çözüm yollarını bulabilir misiniz?", cat: "Sayısal Yetenek" },
                { q: "Akıcı bir üslupla güzel yazı (örneğin bir mektup) yazabilir misiniz?", cat: "Sözel Yetenek" },
                { q: "Okuduğunuz bir parçada anlatılan fikirleri bulup özetleyebiliyor musunuz?", cat: "Sözel Yetenek" },
                { q: "Sizin düzeyinde, ama daha önce hiç görmediğiniz bir matematik kitabını rahatlıkla okuyabilir misiniz?", cat: "Sayısal Yetenek" },
                { q: "Bir evin planına baktığınızda, evin yapılmış halini gözönünde canlandırabilir misiniz?", cat: "Şekil-Uzay Yeteneği" },
                { q: "Bir kağıda çizilen yıldız biçimindeki bir şekli makasla, düzgün bir biçimde kesip çıkarabilir misiniz?", cat: "Göz-El Koordinasyonu" },
                { q: "Alet kullanmadan düzgün geometrik şekiller çizebilir misiniz?", cat: "Göz-El Koordinasyonu" },
                { q: "Attığınız bir bilyeyi veya bir taşı istediğiniz hedefe gönderebilir misiniz?", cat: "Göz-El Koordinasyonu" },
                { q: "Satranç öğrenmek için çaba sarfediyor musunuz?", cat: "Mekanik İlgi" },
                { q: "Fen dersleri ile ilgili konuları kolay öğrenebiliyor musunuz?", cat: "Fen Bilimleri İlgisi" },
                { q: "Desenli kağıtları, şekilleri birbirine tamamlayacak şekilde, yanyana yapıştırabilir misiniz?", cat: "Şekil-Uzay Yeteneği" },
                { q: "Bir aletin (örneğin, saatin) çok küçük bir parçasını (vidasını) yerine kolayca yerleştirebilir misiniz?", cat: "Göz-El Koordinasyonu" },
                { q: "Gelecekte kendinizi, laboratuarda araştırmacı olarak düşlediğiniz oldumu?", cat: "Fen Bilimleri İlgisi" },
                { q: "Bir kente gittiğinizde, müzeleri, tarihi yerleri gezer misiniz?", cat: "Sosyal Bilimler İlgisi" },
                { q: "Çeşitli atasözlerinin ve özdeyişlerin nereden çıktığını araştırmak ister misiniz?", cat: "Edebiyat İlgisi" },
                { q: "İnsanların ne düşündüklerini ve ne hissettiklerini incelemekten hoşlanır mısınız?", cat: "Sosyal Bilimler İlgisi" },
                { q: "Fen derslerinde öğrendiğiniz ilke ve kuralları evinizdeki sorunların çözümünde kullanır mısınız?", cat: "Fen Bilimleri İlgisi" },
                { q: "Fen dersleri ile ilgili konularda sınıfta öğretilenlerden daha fazla bilgi edinmek için başka kaynaklara başvurduğunuz oluyor mu?", cat: "Fen Bilimleri İlgisi" },
                { q: "Evcil hayvanların veya bitkilerin gelişmelerini incelemekten hoşlanır mısınız?", cat: "Fen Bilimleri İlgisi" },
                { q: "Yeni öğrendiğiniz yabancı dildeki sözcükleri bir cümlede kullanmaya çalışır mısınız?", cat: "Yabancı Dil İlgisi" },
                { q: "Fen bilgisi ile ilgili problemleri çözmekten hoşlanır mısınız?", cat: "Fen Bilimleri İlgisi" },
                { q: "Deniz dibindeki hayatı gösteren bir filmi ilgi ve dikkatle izler misiniz?", cat: "Fen Bilimleri İlgisi" },
                { q: "Yabancı dildeki kelimeleri kolaylıkla ezberleyebiliyor musunuz?", cat: "Yabancı Dil İlgisi" },
                { q: "Bir bilyeyi, başka bir bilye ile vurarak, istediğiniz hedefe gönderebilir misiniz?", cat: "Göz-El Koordinasyonu" },
                { q: "Büyük coğrafya keşiflerini anlatan bir televizyon dizisini izlemekten hoşlanır mısınız?", cat: "Sosyal Bilimler İlgisi" },
                { q: "Tarih ve coğrafya derslerinde okutulan konuları kolay öğrenebiliyor musunuz?", cat: "Sosyal Bilimler İlgisi" },
                { q: "Bilimsel proje sergilerini gezer misiniz?", cat: "Fen Bilimleri İlgisi" },
                { q: "İnsanların gazetelerde hangi haberleri merakla okuduklarını araştırmak ister misiniz?", cat: "Sosyal Bilimler İlgisi" },
                { q: "Tarih romanları okumaktan hoşlanır mısınız?", cat: "Edebiyat İlgisi" },
                { q: "Televizyonda bilimsel buluşları anlatan belgesel programları izler misiniz?", cat: "Fen Bilimleri İlgisi" },
                { q: "Ünlü bilim adamlarının hayatını anlatan televizyon dizilerini izler misiniz?", cat: "Fen Bilimleri İlgisi" },
                { q: "Bir pastayı veya böreği, eşit olarak ve düzgün biçimde kesebilir misiniz?", cat: "Göz-El Koordinasyonu" },
                { q: "Çocuklarda yaratıcılık başlıklı bir makaleyi okumak ister misiniz?", cat: "Sosyal Bilimler İlgisi" },
                { q: "Çevrenizdeki insanların davranışlarının nedenlerini merak edip araştırır mısınız?", cat: "Sosyal Bilimler İlgisi" },
                { q: "Uzay araçlarının, roketlerin evrimini gösteren bir sergiyi izlemek ister misiniz?", cat: "Fen Bilimleri İlgisi" },
                { q: "Ünlü toplum liderlerinin hayatını anlatan eserleri okumak veya filmleri izlemek ister misiniz?", cat: "Sosyal Bilimler İlgisi" },
                { q: "İnsan hakları konulu bir ödev hazırlayıp sınıfta sunmak ister misiniz?", cat: "İkna İlgisi" },
                { q: "Küçük bir deliğe, ince bir çubuğu, deliğin kenarına değdirmeden sokabilir misiniz?", cat: "Göz-El Koordinasyonu" },
                { q: "Küçük bir şeklin içini, dışarı taşırmadan sulu boya ile boyayabilir misiniz?", cat: "Göz-El Koordinasyonu" },
                { q: "Orta Asya'daki eski uygarlık eserlerini gösteren bir belgesel filmi izlemekten hoşlanır mısınız?", cat: "Sosyal Bilimler İlgisi" },
                { q: "Evinizde ipekböceği yetiştirip bakımını üstlenebilir misiniz?", cat: "Ziraat İlgisi" },
                { q: "Kapı zili, kilit gibi ev aletlerini onarmaya çalışır mısınız?", cat: "Mekanik İlgi" },
                { q: "Tahtadan veya metalden oyuncaklar yapabilir misiniz?", cat: "Mekanik İlgi" },
                { q: "Yeni çiçek türleri yetiştirmeyi denemek ister misiniz?", cat: "Ziraat İlgisi" },
                { q: "Bir yabancı turistle, bildiğiniz yabancı dille konuşmaya çalışır mısınız?", cat: "Yabancı Dil İlgisi" },
                { q: "Gelecekte yabancı dilinizi ilerletip o dilde yazılmış dergi ve kitapları okumayı düşünür müsünüz?", cat: "Yabancı Dil İlgisi" },
                { q: "Hayvanat bahçesine getirilen hayvanların yeni çevreye uyum sorunları konulu bir belgesel filmi ilgi ile izler misiniz?", cat: "Ziraat İlgisi" },
                { q: "Bir çiftliğin yöneticisi olmayı düşünür müsünüz?", cat: "Ziraat İlgisi" },
                { q: "Yeni öğrendiğiniz yabancı dildeki sözcükleri doğru biçimde söylemeye gayret eder misiniz?", cat: "Yabancı Dil İlgisi" },
                { q: "Kaliteli meyve yetiştiren bir üretici olmayı düşünür müsünüz?", cat: "Ziraat İlgisi" },
                { q: "Bir aleti parçalara ayırıp tekrar birleştirebilir misiniz?", cat: "Mekanik İlgi" },
                { q: "Evcil hayvanların hangi koşullarda ve ortamda daha iyi geliştiklerini incelemekten hoşlanır mısınız?", cat: "Ziraat İlgisi" },
                { q: "Yeni bir alet veya makine ile karşılaştığınızda, hemen onun nasıl çalıştığını öğrenmeye çalışır mısınız?", cat: "Mekanik İlgi" },
                { q: "Evde bir hayvan (kuş) besler, bakımını yapar mısınız?", cat: "Ziraat İlgisi" },
                { q: "Saksıda ve bahçede çiçek yetiştirip bakımını üstlenir misiniz?", cat: "Ziraat İlgisi" },
                { q: "Elektrikli aletlerin nasıl işlediklerini inceler misiniz?", cat: "Mekanik İlgi" },
                { q: "Havuzlarda balık üretme yöntemlerini gösteren bir filmi ilgi ile izler misiniz?", cat: "Ziraat İlgisi" },
                { q: "Her türlü araç ve gereç sağlansa, bir kafes yapmayı dener misiniz?", cat: "Mekanik İlgi" },
                { q: "İnanç ve düşüncelerinizi başkalarına kolaylıkla aktarabilir misiniz?", cat: "İkna İlgisi" },
                { q: "Tartışmalarda güçlü kanıtlar bularak, görüşünüzü karşınızdakilere kabul ettirebilir misiniz?", cat: "İkna İlgisi" },
                { q: "Belleğiniz kuvvetli midir?", cat: "Sözel Yetenek" },
                { q: "İnsanların daha çok hangi malları almak istediklerini öğrenmeye çalışır mısınız?", cat: "Ticaret İlgisi" },
                { q: "Model uçak yapmaya çalışır mısınız?", cat: "Mekanik İlgi" },
                { q: "Arkadaşlarınız arasındaki çatışmaların çözümünde arabuluculuk yapar mısınız?", cat: "İkna İlgisi" },
                { q: "Bir yazıdaki hataları düzeltmekten, bir hesabı kontrol etmekten hoşlanır mısınız?", cat: "İş Ayrıntıları İlgisi" },
                { q: "Yaptığınız herhangi bir işin temiz ve özenli olması için gereken özeni gösterir misiniz?", cat: "İş Ayrıntıları İlgisi" },
                { q: "Bir makinanın, örneğin bir elektrik motorunun, evrimini gösteren bir sergiyi gezmek ister misiniz?", cat: "Mekanik İlgi" },
                { q: "Çevrenizde Hazırcevap bir kişi olarak tanınır mısınız?", cat: "İkna İlgisi" },
                { q: "Okul kantini ya da kooperatifini yönetmek ister misiniz?", cat: "Ticaret İlgisi" },
                { q: "Bir işin ince ayrıntıları ile uğraşır mısınız?", cat: "İş Ayrıntıları İlgisi" },
                { q: "Paranızı nerelerde harcadığınızın kaydını tutar mısınız?", cat: "İş Ayrıntıları İlgisi" },
                { q: "Anılarınızı yazar mısınız?", cat: "Edebiyat İlgisi" },
                { q: "Yaz aylarında bir dükkanda ya da ticarethanede çalışmak ister misiniz?", cat: "Ticaret İlgisi" },
                { q: "Derslerinize günü gününe çalışır mısınız?", cat: "İş Ayrıntıları İlgisi" },
                { q: "Okulda şiir okuma yarışmaları düzenleyen bir grubun üyesi olmak ister misiniz?", cat: "Edebiyat İlgisi" },
                { q: "Mektuplarınızı eski okul karnelerinizi tarih sırasına koyup saklar mısınız?", cat: "İş Ayrıntıları İlgisi" },
                { q: "Aldığınız her şeyin ya da yaptığınız her işin düzenli bir biçimde kaydını tutar mısınız?", cat: "İş Ayrıntıları İlgisi" },
                { q: "Yabancı dil kurslarına gitmek ister misiniz?", cat: "Yabancı Dil İlgisi" },
                { q: "Bir makinanın çalışmasını geliştirici yöntemler düşünür müsünüz?", cat: "Mekanik İlgi" },
                { q: "Söz ve davranışlarınızın başkaları üzerindeki etkilerini öğrenmeye çalışır mısınız?", cat: "İkna İlgisi" },
                { q: "Konuşurken çevrenizdeki insanların ilgisini çekebilir ve görüşlerinizi onlara kabul ettirebilir misiniz?", cat: "İkna İlgisi" },
                { q: "Televizyondaki reklamların daha iyi nasıl yapılabileceği üzerinde araştırma yapan bir grubun içinde yer almak ister misiniz?", cat: "Ticaret İlgisi" },
                { q: "Evleri dolaşıp bir malın tanıtımını yapmaktan hoşlanır mısınız?", cat: "Ticaret İlgisi" },
                { q: "Ödevlerinizi zamanında ve düzgün biçimde yapar mısınız?", cat: "İş Ayrıntıları İlgisi" },
                { q: "Televizyonda veya radyoda şiir saatlerini izler misiniz?", cat: "Edebiyat İlgisi" },
                { q: "Kendini gelecekte bir yazar olarak düşlediğiniz olur mu?", cat: "Edebiyat İlgisi" },
                { q: "Yaptığınız her hangi bir şeyi özenle süsler misiniz?", cat: "Güzel Sanatlar İlgisi" },
                { q: "Küçük hikayeler yazmayı dener misiniz?", cat: "Edebiyat İlgisi" },
                { q: "Ünlü sanatçıların, ressamların hayatını merak eder misiniz?", cat: "Güzel Sanatlar İlgisi" },
                { q: "Çevrenizdeki çeşitli makinaların bakımını yapar, onları bozmadan kullanabilir misiniz?", cat: "Mekanik İlgi" },
                { q: "Sizin gibi düşünmeyen insanları ikna etmek için uzun tartışmalara girer misiniz?", cat: "İkna İlgisi" },
                { q: "Çevrenizdeki eşyaların, ürünlerin, satılsalar kaç lira edeceklerini düşünür müsünüz?", cat: "Ticaret İlgisi" },
                { q: "Eşyalarınızı yerli yerine koyar, çevrenizi düzenli tutar mısınız?", cat: "İş Ayrıntıları İlgisi" },
                { q: "Bir malı satmak için neler yapmak gerektiğini öğreten bir kursa katılmak ister misiniz?", cat: "Ticaret İlgisi" },
                { q: "Gazete, boş şişe gibi kullanılmış şeyleri satarak para kazanmayı düşünür müsünüz?", cat: "Ticaret İlgisi" },
                { q: "Yabancı dilde şarkı söylemeye özenir misiniz?", cat: "Yabancı Dil İlgisi" },
                { q: "Mektupları zamanında cevaplandırır mısınız?", cat: "İş Ayrıntıları İlgisi" },
                { q: "Bir şeyi satın alacağınız zaman çeşitli dükkanları dolaşıp fiyatları karşılaştırarak gereğini duyar mısınız?", cat: "Ticaret İlgisi" },
                { q: "Bir aleti, tarifesine ve şemasına bakarak çalıştırabilir misiniz?", cat: "Mekanik İlgi" },
                { q: "Güzel konuşma ve başkalarını ikna edebilme gücünü geliştirici kurslara katılmak ister misiniz?", cat: "İkna İlgisi" },
                { q: "Arkadaşlarınıza ciklet, çikolata, bilye vb. şeyler sattınız mı?", cat: "Ticaret İlgisi" },
                { q: "Gelecekte kendinizi bir tüccar olarak düşlediğiniz olur mu?", cat: "Ticaret İlgisi" },
                { q: "Roman, hikaye veya şiir okur musunuz?", cat: "Edebiyat İlgisi" },
                { q: "Boş vakitlerinizde çiçek, nakış, resim, heykel vb. yapar mısınız?", cat: "Güzel Sanatlar İlgisi" },
                { q: "Radyo ve televizyonda müzik programlarını izler misiniz?", cat: "Müzik İlgisi" },
                { q: "Müzik yarışmalarına katılmak ister misiniz?", cat: "Müzik İlgisi" },
                { q: "Televizyonda resim sanatı ile ilgili haberleri ilgi ile izler misiniz?", cat: "Güzel Sanatlar İlgisi" },
                { q: "Gittiğiniz bir kentte sanat galerilerini, resim sergilerini gezmek ister misiniz?", cat: "Güzel Sanatlar İlgisi" },
                { q: "Ağlayan bir çocuğu oyalayabilir misiniz?", cat: "Sosyal Yardım İlgisi" },
                { q: "Yaşlılar yurdunda eğlence günleri düzenlemekten hoşlanır mısınız?", cat: "Sosyal Yardım İlgisi" },
                { q: "Başkalarına kişisel sorunların çözümünde yardımcı olabiliyor musunuz?", cat: "Sosyal Yardım İlgisi" },
                { q: "Çocuk gürültüsüne katlanabilir misiniz?", cat: "Sosyal Yardım İlgisi" },
                { q: "Belli bir anda pek çok şeye birden dikkat edebilir misiniz?", cat: "Sözel Yetenek" },
                { q: "Kompozisyon derslerinde başarılı mısınız?", cat: "Edebiyat İlgisi" },
                { q: "Okul gazetesine yazı yazar mısınız?", cat: "Edebiyat İlgisi" },
                { q: "Müzik dersleri alıyor musunuz veya almak ister misiniz?", cat: "Müzik İlgisi" },
                { q: "Bir müzik aleti çalar mısınız?", cat: "Müzik İlgisi" },
                { q: "Bir hastaya bakabilir, ilaçlarını zamanında verebilir misiniz?", cat: "Sosyal Yardım İlgisi" },
                { q: "Resim ve mimarlık sanatının gelişimini anlatan bir kitabı zevkle okur musunuz?", cat: "Güzel Sanatlar İlgisi" },
                { q: "Bir hastanede, yaz aylarında gönüllü olarak çalışmak ister misiniz?", cat: "Sosyal Yardım İlgisi" },
                { q: "Boş vakitlerinizi resim veya el işleri yaparak geçirmeye çalışır mısınız?", cat: "Güzel Sanatlar İlgisi" },
                { q: "Konuştuğunuz zaman kendinizi çevrenizdeki insanlara dinletebiliyor musunuz?", cat: "İkna İlgisi" },
                { q: "Karşınızdaki insanların ne düşündükleri ve ne hissettiklerini anlayabilir misiniz?", cat: "Sosyal Yardım İlgisi" },
                { q: "Müzik aletleri sergisini gezmek ister misiniz?", cat: "Müzik İlgisi" },
                { q: "Çeşitli ülkelerin halk şarkılarını tanıtan bir program izler misiniz?", cat: "Müzik İlgisi" },
                { q: "Hastalar ve yaşlılara kitap okumaktan hoşlanır mısınız?", cat: "Sosyal Yardım İlgisi" },
                { q: "Küçük çocuklara oyun öğretmekten, onlara şarkı söylemekten hoşlanır mısınız?", cat: "Sosyal Yardım İlgisi" },
                { q: "İmkanlarınız ölçüsünde konserlere gitmeye çalışır mısınız?", cat: "Müzik İlgisi" },
                { q: "Yabancı dil dersinde başarılı mısınız?", cat: "Yabancı Dil İlgisi" },
                { q: "Ayakta ve hareketli olarak çalışmaktan hoşlanır mısınız?", cat: "Sosyal Yardım İlgisi" },
                { q: "Ufak tefek besteler yapmaya çalışır mısınız?", cat: "Müzik İlgisi" },
                { q: "Bir evi ya da salonu süslemekten hoşlanır mısınız?", cat: "Güzel Sanatlar İlgisi" },
                { q: "Başkalarına dinletecek düzeyde bir müzik aleti çalıyor musunuz?", cat: "Müzik İlgisi" },
                { q: "Odanızı, yaptığınız resim veya el işleri ile süsler misiniz?", cat: "Güzel Sanatlar İlgisi" },
                { q: "El sanatları ya da resim kurslarına gitmek ister misiniz?", cat: "Güzel Sanatlar İlgisi" },
                { q: "Yeni duyduğunuz bir müzik parçasını çalmaya veya söylemeye çalışır mısınız?", cat: "Müzik İlgisi" },
                { q: "Gazete ve dergilerdeki edebiyat sütunlarını okur musunuz?", cat: "Edebiyat İlgisi" },
                { q: "Okul kitaplığına gider ve kitap alır mısınız?", cat: "Edebiyat İlgisi" },
                { q: "Dilbilgisi kurallarını öğrenip uygulayabiliyor musunuz?", cat: "Sözel Yetenek" },
                { q: "Görüşlerinize karşı çıkıldığında bunu soğukkanlılıkla karşılar mısınız?", cat: "Sosyal Yardım İlgisi" },
                { q: "Açık havada çalışmaktan hoşlanır mısınız?", cat: "Sosyal Yardım İlgisi" },
                { q: "Gelecekte kendinizi çeşitli dillerin yapı ve özellikleri üzerinde çalışan bir araştırmacı olarak düşünebilir misiniz?", cat: "Yabancı Dil İlgisi" }
            ];
            
            questions = [];
            questionsData.forEach((item, index) => {
                questions.push({
                    id: index + 1,
                    question: item.q,
                    category: item.cat
                });
            });
        }

        // Load careers data
        function loadCareers() {
            // Use imported career data
            careers = careerData.map((career, index) => ({
                id: index + 1,
                name: career.name,
                summary: career.description,
                description: career.description,
                icon: 'fas fa-briefcase', // Default icon
                color: 'primary', // Default color
                requirements: career.requirements,
                vrDescription: career.vrDescription || `${career.name} mesleğini VR ile deneyimleyin!`,
                illustration: career.vr_image,
                hasVRVideo: career.hasVRVideo || false,
                vrVideoFile: career.vrVideoFile || null
            }));
        }

        // Initialize test
        function initializeTest() {
            currentQuestionIndex = 0;
            if (questions.length > 0) {
                displayQuestion();
                updateProgress();
            }
            
            // Remove existing event listeners first to prevent duplicates
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.replaceWith(btn.cloneNode(true));
            });
            
            // Add answer button event listeners (only once)
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.classList.contains('processing')) return; // Prevent double clicks
                    this.classList.add('processing');
                    
                    setTimeout(() => {
                        this.classList.remove('processing');
                    }, 600);
                    
                    selectAnswer(parseInt(this.dataset.value));
                });
            });
        }

        // Display current question
        function displayQuestion() {
            if (currentQuestionIndex >= questions.length) {
                finishTest();
                return;
            }
            
            const question = questions[currentQuestionIndex];
            document.getElementById('question-text').textContent = question.question;
            
            // Clear previous selections
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Show previous answer if exists
            if (answers[question.id]) {
                const selectedBtn = document.querySelector(`[data-value="${answers[question.id].value}"]`);
                if (selectedBtn) {
                    selectedBtn.classList.add('selected');
                }
            }
        }

        // Select answer
        function selectAnswer(value) {
            // Prevent multiple calls
            if (selectAnswer.isProcessing) return;
            selectAnswer.isProcessing = true;
            
            const question = questions[currentQuestionIndex];
            
            // Validate question exists
            if (!question || currentQuestionIndex >= questions.length) {
                selectAnswer.isProcessing = false;
                return;
            }
            
            // Save answer
            answers[question.id] = {
                value: value,
                category: question.category
            };
            
            // Update UI
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            const selectedBtn = document.querySelector(`[data-value="${value}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
            }
            
            // Save to localStorage
            localStorage.setItem('abko_answers', JSON.stringify(answers));
            
            // Move to next question after a short delay
            setTimeout(() => {
                currentQuestionIndex++;
                displayQuestion();
                updateProgress();
                selectAnswer.isProcessing = false;
            }, 500);
        }

        // Update progress bar
        function updateProgress() {
            const progress = ((currentQuestionIndex) / questions.length) * 100;
            document.getElementById('test-progress').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `${currentQuestionIndex} / ${questions.length}`;
        }

        // Finish test and show results
        function finishTest() {
            calculateResults();
        }

        // Calculate test results
        function calculateResults() {
            const categoryScores = {};
            academicCategories.forEach(cat => {
                categoryScores[cat.name] = { total: 0, count: 0 };
            });

            questions.forEach(q => {
                const answer = answers[q.id];
                if (answer !== undefined) {
                    categoryScores[q.category].total += answer.value;
                    categoryScores[q.category].count++;
                }
            });

            const finalScores = {};
            for (const categoryName in categoryScores) {
                if (categoryScores[categoryName].count > 0) {
                    finalScores[categoryName] = categoryScores[categoryName].total / categoryScores[categoryName].count;
                } else {
                    finalScores[categoryName] = 0;
                }
            }

            // Calculate career matches
            const careerMatches = careerData.map(career => {
                let totalMatch = 0;
                let totalRequirements = 0;
                let matchedRequirements = 0;

                for (const reqCategory in career.requirements) {
                    const requiredScore = career.requirements[reqCategory];
                    const userScore = finalScores[reqCategory] || 0;

                    totalRequirements += requiredScore;

                    // Calculate weighted match for each category
                    const match = Math.min(userScore, requiredScore) / requiredScore;
                    totalMatch += match * requiredScore; // Weight by required score

                    if (userScore >= requiredScore) {
                        matchedRequirements++;
                    }
                }

                const matchPercentage = totalRequirements > 0 ? (totalMatch / totalRequirements) * 100 : 0;

                return {
                    ...career,
                    matchPercentage: matchPercentage,
                    matchedRequirementsCount: matchedRequirements,
                    totalRequirementsCount: Object.keys(career.requirements).length
                };
            });

            // Sort careers by match percentage in descending order
            careerMatches.sort((a, b) => b.matchPercentage - a.matchPercentage);

            displayResults(finalScores, careerMatches);
        }

        // Get top 3 areas
        function getTopAreas(scores) {
            if (!scores || typeof scores !== 'object') {
                return [];
            }
            return Object.entries(scores)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3)
                .map(([category, score]) => ({
                    category,
                    score: score.toFixed(1)
                }));
        }

        // Get recommended careers
        function getRecommendedCareers(userScores) {
            const recommendations = [];
            
            careers.forEach(career => {
                let totalMatch = 0;
                let requirementCount = 0;
                
                Object.entries(career.requirements).forEach(([category, requiredScore]) => {
                    const userScore = userScores[category] || 0;
                    const match = Math.min(userScore / requiredScore, 1);
                    totalMatch += match;
                    requirementCount++;
                });
                
                const matchPercentage = Math.round((totalMatch / requirementCount) * 100);
                
                if (matchPercentage >= 60) {
                    recommendations.push({
                        ...career,
                        matchPercentage
                    });
                }
            });
            
            return recommendations.sort((a, b) => b.matchPercentage - a.matchPercentage);
        }

        async function saveTestResults(finalScores, careerMatches) {
            if (!db || !authUser) return;
            const recommendedCareers = careerMatches
                .filter(career => career.matchPercentage >= 60)
                .map(career => ({
                    name: career.name,
                    matchPercentage: Math.round(career.matchPercentage)
                }));
            await db.collection('testResults').add({
                userId: authUser.uid,
                username: authUser.displayName || '',
                role: currentUserRole,
                categoryScores: finalScores,
                topAreas: getTopAreas(finalScores),
                recommendedCareers,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        }

        let advisorChart = null;

        function getReadableDate(timestamp) {
            if (!timestamp) return '-';
            if (timestamp.seconds) {
                return new Date(timestamp.seconds * 1000).toLocaleDateString('tr-TR');
            }
            return new Date(timestamp).toLocaleDateString('tr-TR');
        }

        async function loadAdvisorDashboard() {
            if (!db || !authUser || !isAdvisor()) return;
            const listBody = document.getElementById('advisor-student-list');
            if (!listBody) return;
            listBody.innerHTML = '<tr><td colspan="3">Öğrenciler yükleniyor...</td></tr>';
            try {
                const snapshot = await db.collection('users')
                    .where('advisorId', '==', authUser.uid)
                    .get();
                if (snapshot.empty) {
                    listBody.innerHTML = '<tr><td colspan="3">Atanmış öğrenci bulunamadı.</td></tr>';
                    return;
                }
                listBody.innerHTML = '';
                const studentPromises = snapshot.docs.map(async doc => {
                    const data = doc.data();
                    const resultsSnapshot = await db.collection('testResults')
                        .where('userId', '==', doc.id)
                        .orderBy('createdAt', 'desc')
                        .get();
                    const latestResult = resultsSnapshot.docs[0]?.data();
                    const row = document.createElement('tr');
                    row.classList.add('advisor-row');
                    row.dataset.studentId = doc.id;
                    row.innerHTML = `
                        <td>${data.username || 'Öğrenci'}</td>
                        <td>${latestResult ? getReadableDate(latestResult.createdAt) : '-'}</td>
                        <td>${resultsSnapshot.size}</td>
                    `;
                    row.addEventListener('click', () => {
                        document.querySelectorAll('.advisor-row').forEach(item => item.classList.remove('active'));
                        row.classList.add('active');
                        loadAdvisorStudentDetails(doc.id, data.username || 'Öğrenci');
                    });
                    listBody.appendChild(row);
                });
                await Promise.all(studentPromises);
            } catch (error) {
                console.error('Advisor dashboard load error:', error);
                listBody.innerHTML = '<tr><td colspan="3">Öğrenciler yüklenirken hata oluştu.</td></tr>';
            }
        }

        async function loadAdvisorStudentDetails(studentId, studentName) {
            const nameEl = document.getElementById('advisor-student-name');
            const metaEl = document.getElementById('advisor-student-meta');
            const resultsBody = document.getElementById('advisor-results-list');
            if (nameEl) nameEl.textContent = studentName;
            if (metaEl) metaEl.textContent = 'Test sonuçları yükleniyor...';
            if (resultsBody) resultsBody.innerHTML = '<tr><td colspan="3">Sonuçlar yükleniyor...</td></tr>';
            try {
                const resultsSnapshot = await db.collection('testResults')
                    .where('userId', '==', studentId)
                    .orderBy('createdAt', 'asc')
                    .get();
                if (resultsSnapshot.empty) {
                    if (metaEl) metaEl.textContent = 'Öğrencinin henüz test sonucu yok.';
                    if (resultsBody) resultsBody.innerHTML = '<tr><td colspan="3">Sonuç bulunamadı.</td></tr>';
                    updateAdvisorChart([]);
                    return;
                }
                const results = resultsSnapshot.docs.map(doc => doc.data());
                if (metaEl) metaEl.textContent = `${results.length} test sonucu bulundu.`;
                if (resultsBody) {
                    resultsBody.innerHTML = results.map(result => {
                        const topAreas = (result.topAreas || [])
                            .map(area => `${area.category} (${area.score})`)
                            .join(', ');
                        return `
                            <tr>
                                <td>${getReadableDate(result.createdAt)}</td>
                                <td>${topAreas || '-'}</td>
                                <td>${result.recommendedCareers ? result.recommendedCareers.length : 0}</td>
                            </tr>
                        `;
                    }).join('');
                }
                updateAdvisorChart(results);
            } catch (error) {
                console.error('Advisor student detail error:', error);
                if (metaEl) metaEl.textContent = 'Sonuçlar yüklenirken hata oluştu.';
                if (resultsBody) resultsBody.innerHTML = '<tr><td colspan="3">Sonuçlar yüklenirken hata oluştu.</td></tr>';
                updateAdvisorChart([]);
            }
        }

        function updateAdvisorChart(results) {
            const chartCanvas = document.getElementById('advisor-progress-chart');
            if (!chartCanvas || typeof Chart === 'undefined') return;
            if (advisorChart instanceof Chart) {
                advisorChart.destroy();
            }
            const labels = results.map(result => getReadableDate(result.createdAt));
            const dataPoints = results.map(result => {
                const scores = Object.values(result.categoryScores || {});
                const topScore = scores.length ? Math.max(...scores) : 0;
                return Number.isFinite(topScore) ? Number(topScore.toFixed(2)) : 0;
            });
            advisorChart = new Chart(chartCanvas.getContext('2d'), {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'En Yüksek Puan',
                        data: dataPoints,
                        borderColor: '#FFD700',
                        backgroundColor: 'rgba(255, 215, 0, 0.2)',
                        borderWidth: 2,
                        pointRadius: 4,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#FFFFFF'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#FFFFFF' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            ticks: { color: '#FFFFFF' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            beginAtZero: true,
                            max: 4
                        }
                    }
                }
            });
        }

        // Display results  
        function displayResults(finalScores, careerMatches) {
            // Use existing page navigation system
            showPage('results');
            
            // Store results globally for other functions to use
            testResults = {
                categoryScores: finalScores,
                topAreas: getTopAreas(finalScores),
                recommendedCareers: careerMatches.filter(career => career.matchPercentage >= 60)
            };

            saveTestResults(finalScores, careerMatches).catch(error => {
                console.error('Test result save error:', error);
            });
            
            // Update existing radar chart if it exists
            setTimeout(() => {
                const ctx = document.getElementById('radarChart');
                if (ctx && typeof Chart !== 'undefined') {
                    displayRadarChart(finalScores);
                }
                
                // Update top areas if container exists
                const topAreasContainer = document.getElementById('top-areas-list');
                if (topAreasContainer) {
                    displayTopAreas(finalScores);
                }
                
                // Update career results if container exists  
                const careerContainer = document.getElementById('career-results');
                if (careerContainer) {
                    displayCareerRecommendations(careerMatches);
                }
            }, 100);
        }
        
        // Display existing results when navigating to results page
        function displayExistingResults() {
            if (!window.testResults || !window.testResults.categoryScores) {
                return;
            }
            
            const finalScores = window.testResults.categoryScores;
            const recommendedCareers = window.testResults.recommendedCareers || [];
            
            // Update existing radar chart if it exists
            setTimeout(() => {
                const ctx = document.getElementById('radarChart');
                if (ctx && typeof Chart !== 'undefined') {
                    displayRadarChart(finalScores);
                }
                
                // Update top areas if container exists
                const topAreasContainer = document.getElementById('top-areas-list');
                if (topAreasContainer) {
                    displayTopAreas(finalScores);
                }
                
                // Update career results if container exists  
                const careerContainer = document.getElementById('career-results');
                if (careerContainer) {
                    displayCareerRecommendations(recommendedCareers);
                }
            }, 100);
        }
        
        // Display radar chart with new data
        function displayRadarChart(finalScores) {
            const ctx = document.getElementById('radarChart');
            if (!ctx) return;
            
            if (!finalScores || typeof finalScores !== 'object') {
                return;
            }
            
            const chartContext = ctx.getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.radarChart instanceof Chart) {
                window.radarChart.destroy();
            }

            const labels = Object.keys(finalScores);
            const data = Object.values(finalScores);

            window.radarChart = new Chart(chartContext, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Puanlarınız',
                        data: data,
                        backgroundColor: 'rgba(255, 215, 0, 0.2)',
                        borderColor: '#FFD700',
                        borderWidth: 2,
                        pointBackgroundColor: '#FFD700',
                        pointBorderColor: '#FFA500',
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#FFFFFF'
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 4,
                            ticks: {
                                color: '#FFFFFF',
                                stepSize: 1
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.2)'
                            },
                            pointLabels: {
                                color: '#FFFFFF',
                                font: {
                                    size: 10
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Display top areas with new data
        function displayTopAreas(finalScores) {
            const container = document.getElementById('top-areas-list');
            if (!container) return;
            
            if (!finalScores || typeof finalScores !== 'object') {
                container.innerHTML = '<p>No results available</p>';
                return;
            }
            
            container.innerHTML = '';
            
            const sortedScores = Object.entries(finalScores)
                .sort(([, scoreA], [, scoreB]) => scoreB - scoreA)
                .slice(0, 3);
            
            sortedScores.forEach(([category, score]) => {
                const areaElement = document.createElement('div');
                areaElement.className = 'area-item';
                areaElement.innerHTML = `
                    <div>
                        <i class="fas fa-star me-2"></i>
                        ${category}
                    </div>
                    <span class="area-score">${score.toFixed(2)}/4.0</span>
                `;
                container.appendChild(areaElement);
            });
        }
        
        // Display career recommendations with new data
        function displayCareerRecommendations(careerMatches) {
            const container = document.getElementById('career-results');
            if (!container) return;
            
            if (!careerMatches || !Array.isArray(careerMatches)) {
                container.innerHTML = '<p>No career recommendations available</p>';
                return;
            }
            
            container.innerHTML = '';
            
            const recommendedCareers = careerMatches.filter(career => career.matchPercentage >= 60);
            
            if (recommendedCareers.length > 0) {
                recommendedCareers.forEach((career, index) => {
                    const careerCard = document.createElement('div');
                    careerCard.className = 'career-card';
                    careerCard.innerHTML = `
                        <div class="career-header">
                            <i class="fas fa-briefcase career-icon"></i>
                            <span class="career-match">${Math.round(career.matchPercentage)}% Uyum</span>
                        </div>
                        <h4 class="career-title">${career.name}</h4>
                        <p class="career-description">${career.description}</p>
                        <div class="career-actions">
                            <button class="btn-career btn-career-primary" onclick="showCareerDetail(${index + 1})">
                                <i class="fas fa-info-circle me-1"></i>Detayları Gör
                            </button>
                            <button class="btn-career btn-career-secondary" onclick="openVRSimulation(${index + 1})">
                                <i class="fas fa-vr-cardboard me-1"></i>VR
                            </button>
                        </div>
                    `;
                    container.appendChild(careerCard);
                });
            } else {
                container.innerHTML = `
                    <div class="col-12 text-center">
                        <div class="alert alert-info">
                            <h5>Henüz uygun meslek bulunamadı</h5>
                            <p>Puanlarınıza %60 ve üzeri uyum gösteren meslek bulunamadı. Testi tekrar çözmeyi deneyebilirsiniz.</p>
                        </div>
                    </div>
                `;
            }
        }

        // Load all careers for careers page
        function loadAllCareers() {
            const container = document.getElementById('all-careers');
            container.innerHTML = '';
            
            careers.forEach(career => {
                const careerCard = document.createElement('div');
                careerCard.className = 'career-card';
                careerCard.innerHTML = `
                    <div class="career-header">
                        <i class="${career.icon} career-icon"></i>
                    </div>
                    <h4 class="career-title">${career.name}</h4>
                    <p class="career-description">${career.summary}</p>
                    <div class="career-actions">
                        <button class="btn-career btn-career-primary" onclick="showCareerDetail(${career.id})">
                            <i class="fas fa-info-circle me-1"></i>Detayları Gör
                        </button>
                        <button class="btn-career btn-career-secondary" onclick="openVRSimulation(${career.id})">
                            <i class="fas fa-vr-cardboard me-1"></i>VR Deneyimi
                        </button>
                    </div>
                `;
                container.appendChild(careerCard);
            });
        }

        // Load VR careers for VR explore page
        function loadVRCareers() {
            const container = document.getElementById('vr-career-list');
            container.innerHTML = '';
            
            const availableCareers = testResults ? testResults.recommendedCareers : careers.slice(0, 4);
            
            availableCareers.forEach(career => {
                const vrCard = document.createElement('div');
                vrCard.className = 'vr-career-card';
                vrCard.onclick = () => openVRSimulation(career.id);
                vrCard.innerHTML = `
                    <i class="${career.icon} vr-career-icon"></i>
                    <h5 class="vr-career-title">${career.name}</h5>
                    <p class="vr-career-subtitle">VR Simülasyonu</p>
                `;
                container.appendChild(vrCard);
            });
        }

        // Show career detail modal
        function showCareerDetail(careerId) {
            const career = careers.find(c => c.id === careerId);
            if (!career) return;
            
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content" style="background: var(--gradient-card); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-light);">
                        <div class="modal-header" style="border-bottom: 1px solid rgba(255, 255, 255, 0.2);">
                            <h5 class="modal-title">
                                <i class="${career.icon} me-2" style="color: var(--accent-yellow);"></i>${career.name}
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <h6 style="color: var(--accent-yellow);">Meslek Tanımı</h6>
                            <p>${career.description}</p>
                            
                            <h6 style="color: var(--accent-yellow);">Gerekli Akademik Alanlar</h6>
                            <div class="row g-2">
                                ${Object.entries(career.requirements).map(([category, score]) => `
                                    <div class="col-md-6">
                                        <div class="d-flex justify-content-between align-items-center p-2" style="background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
                                            <span><i class="fas fa-star me-2"></i>${category}</span>
                                            <span class="badge" style="background: var(--accent-yellow); color: var(--primary-purple);">${score}/4.0</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="text-center mt-4">
                                <button class="btn btn-primary btn-lg" onclick="openVRSimulation(${career.id}); bootstrap.Modal.getInstance(this.closest('.modal')).hide();">
                                    <i class="fas fa-vr-cardboard me-2"></i>VR Simülasyonunu Başlat
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            // Remove modal from DOM when hidden
            modal.addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modal);
            });
        }

        // Open VR simulation
        function openVRSimulation(careerId) {
            const career = careers.find(c => c.id === careerId);
            if (!career) return;
            
            currentSimulation = career;
            
            // Update simulation page content
            document.getElementById('simulation-title').textContent = `${career.name.toUpperCase()} MESLEĞİ SİMÜLASYONU`;
            
            showPage('vr-simulation');
            
            // Initialize VR video player if career has VR video
            if (career.hasVRVideo && career.vrVideoFile) {
                setTimeout(() => {
                    initVRVideoPlayer(career.vrVideoFile);
                }, 500);
            }
        }

        // Get career illustration
        function getCareerIllustration(illustrationType) {
            const illustrations = {
                'doctor-office': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-user-md"></i>
                        <i class="fas fa-stethoscope ms-3"></i>
                        <i class="fas fa-heartbeat ms-3"></i>
                    </div>
                `,
                'classroom': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <i class="fas fa-book ms-3"></i>
                        <i class="fas fa-graduation-cap ms-3"></i>
                    </div>
                `,
                'courtroom': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-balance-scale"></i>
                        <i class="fas fa-gavel ms-3"></i>
                        <i class="fas fa-landmark ms-3"></i>
                    </div>
                `,
                'construction-site': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-hard-hat"></i>
                        <i class="fas fa-tools ms-3"></i>
                        <i class="fas fa-building ms-3"></i>
                    </div>
                `,
                'software-office': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-laptop-code"></i>
                        <i class="fas fa-mobile-alt ms-3"></i>
                        <i class="fas fa-code ms-3"></i>
                    </div>
                `,
                'art-studio': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-palette"></i>
                        <i class="fas fa-paint-brush ms-3"></i>
                        <i class="fas fa-image ms-3"></i>
                    </div>
                `,
                'nurse-station': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-user-nurse"></i>
                        <i class="fas fa-hospital ms-3"></i>
                        <i class="fas fa-pills ms-3"></i>
                    </div>
                `,
                'music-studio': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-music"></i>
                        <i class="fas fa-guitar ms-3"></i>
                        <i class="fas fa-microphone ms-3"></i>
                    </div>
                `,
                'fashion-studio': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-tshirt"></i>
                        <i class="fas fa-cut ms-3"></i>
                        <i class="fas fa-magic ms-3"></i>
                    </div>
                `,
                'business-office': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-briefcase"></i>
                        <i class="fas fa-chart-line ms-3"></i>
                        <i class="fas fa-handshake ms-3"></i>
                    </div>
                `,
                'agricultural-field': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-seedling"></i>
                        <i class="fas fa-tractor ms-3"></i>
                        <i class="fas fa-leaf ms-3"></i>
                    </div>
                `,
                'tourism-guide': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-map-marked-alt"></i>
                        <i class="fas fa-camera ms-3"></i>
                        <i class="fas fa-globe-americas ms-3"></i>
                    </div>
                `,
                'electrical-lab': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-bolt"></i>
                        <i class="fas fa-microchip ms-3"></i>
                        <i class="fas fa-plug ms-3"></i>
                    </div>
                `,
                'child-development': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-baby"></i>
                        <i class="fas fa-child ms-3"></i>
                        <i class="fas fa-puzzle-piece ms-3"></i>
                    </div>
                `,
                'handicrafts-workshop': `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem; color: var(--accent-yellow);">
                        <i class="fas fa-hands"></i>
                        <i class="fas fa-scissors ms-3"></i>
                        <i class="fas fa-gem ms-3"></i>
                    </div>
                `
            };
            
            return illustrations[illustrationType] || illustrations['doctor-office'];
        }

        // Load answers from localStorage
        function loadAnswersFromStorage() {
            const saved = localStorage.getItem('abko_answers');
            if (saved) {
                answers = JSON.parse(saved);
            }
        }

        // Fill randomly for testing
        function fillRandomly() {
            for (let i = 0; i < questions.length; i++) {
                const question = questions[i];
                answers[question.id] = {
                    value: Math.floor(Math.random() * 4) + 1,
                    category: question.category
                };
            }
            localStorage.setItem('abko_answers', JSON.stringify(answers));
            finishTest();
        }

        // Reset test
        function resetTest() {
            answers = {};
            currentQuestionIndex = 0;
            testResults = null;
            localStorage.removeItem('abko_answers');
            
            if (document.getElementById('test-page').classList.contains('active')) {
                initializeTest();
            }
        }

        // Add scroll animations
        function addScrollAnimations() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, observerOptions);
            
            // Observe elements that should animate
            document.querySelectorAll('.career-card, .action-card, .area-item').forEach(el => {
                el.classList.add('fade-in');
                observer.observe(el);
            });
        }

        // Add video placeholder click handler
        document.addEventListener('click', function(e) {
            if (e.target.closest('.video-placeholder')) {
                // Show VR experience modal
                const modal = document.createElement('div');
                modal.className = 'modal fade';
                modal.innerHTML = `
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content" style="background: var(--gradient-card); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-light);">
                            <div class="modal-header" style="border-bottom: 1px solid rgba(255, 255, 255, 0.2);">
                                <h5 class="modal-title">
                                    <i class="fas fa-vr-cardboard me-2" style="color: var(--accent-yellow);"></i>VR Deneyimi
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body text-center p-5">
                                <div class="mb-4">
                                    <i class="fas fa-vr-cardboard" style="font-size: 5rem; color: var(--accent-yellow);"></i>
                                </div>
                                <h4 class="mb-3">${currentSimulation ? currentSimulation.name : 'Meslek'} VR Deneyimi</h4>
                                <p class="lead mb-4">Bu mesleği sanal gerçeklik ile deneyimlemeye hazırlanıyorsunuz!</p>
                                <div class="alert alert-warning" style="background: rgba(255, 193, 7, 0.2); border: 1px solid rgba(255, 193, 7, 0.5); color: var(--text-light);">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>Yakında:</strong> VR içeriği şu anda hazırlanmaktadır. Bu özellik gelecek güncellemede aktif olacaktır.
                                </div>
                                <div class="mt-4">
                                    <p style="color: rgba(255, 255, 255, 0.7);">
                                        <i class="fas fa-info-circle me-2"></i>
                                        VR deneyimi için VR gözlük veya uyumlu cihaz gereklidir.
                                    </p>
                                </div>
                            </div>
                            <div class="modal-footer" style="border-top: 1px solid rgba(255, 255, 255, 0.2);">
                                <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Kapat</button>
                                <button type="button" class="btn btn-primary" disabled>
                                    <i class="fas fa-play me-2"></i>VR'ı Başlat (Yakında)
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
                
                modal.addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modal);
                });
            }
        });

        // 360 VR Video Player Functions
        function initVRVideoPlayer(videoFile) {
            const container = document.getElementById('vr-video-container');
            
            // Check if it's a YouTube video
            if (videoFile.includes('youtube.com') || videoFile.includes('youtu.be')) {
                initYouTubeVR(videoFile);
                return;
            }
            
            // For local video files (if needed in future)
            showVideoError('Video formatı desteklenmiyor. VR deneyimi için YouTube video kullanın.');
        }

        // YouTube VR Integration
        function initYouTubeVR(videoUrl) {
            const container = document.getElementById('vr-video-container');
            const videoId = extractYouTubeId(videoUrl);
            
            console.log('360° VR Video başlatılıyor...');
            console.log('Video ID:', videoId);
            console.log('Original URL:', videoUrl);
            
            if (!videoId) {
                showVideoError('Video yüklenemedi - Video ID bulunamadı');
                return;
            }
            
            container.innerHTML = `
                <div class="vr-loading">
                    <div class="spinner"></div>
                    <p>360° VR Deneyimi Yükleniyor...</p>
                    <p style="font-size: 0.9rem; opacity: 0.7;">İnternet bağlantısı kontrol ediliyor...</p>
                </div>
                <div id="vr-video-iframe">
                    <iframe 
                        width="100%" 
                        height="100%" 
                        src="https://www.youtube.com/embed/${videoId}?autoplay=1&enablejsapi=1&rel=0&modestbranding=1&origin=${window.location.origin}" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen" 
                        allowfullscreen
                        onload="onYouTubeIframeLoad()"
                        onerror="onYouTubeIframeError()">
                    </iframe>
                </div>
            `;
            
            console.log('YouTube iframe oluşturuldu');
            
            // Set timeout for loading
            setTimeout(() => {
                const loading = document.querySelector('.vr-loading');
                if (loading) {
                    loading.innerHTML = `
                        <div class="spinner"></div>
                        <p>Video yükleniyor...</p>
                        <p style="font-size: 0.9rem; opacity: 0.7;">Biraz daha bekleyin...</p>
                    `;
                }
            }, 3000);
            
            // Add event listeners
            addVREventListeners();
            
            // Add ESC key listener for closing VR
            document.addEventListener('keydown', handleVRKeyPress);
        }

        // YouTube iframe load success
        function onYouTubeIframeLoad() {
            console.log('YouTube iframe başarıyla yüklendi');
            const loading = document.querySelector('.vr-loading');
            if (loading) {
                loading.remove();
            }
        }

        // YouTube iframe load error
        function onYouTubeIframeError() {
            console.error('YouTube iframe yüklenirken hata oluştu');
            showVideoError('YouTube video yüklenemedi. İnternet bağlantınızı kontrol edin.');
        }

        function extractYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        function initThreeJSScene() {
            const container = document.getElementById('vr-video-container');
            
            try {
                // Check if Three.js is loaded
                if (typeof THREE === 'undefined') {
                    throw new Error('Three.js kütüphanesi yüklenemedi');
                }
                
                // Create scene
                vrScene = new THREE.Scene();
                
                // Create camera
                vrCamera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
                vrCamera.position.set(0, 0, 0.1);
                
                // Create renderer
                vrRenderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                vrRenderer.setSize(container.clientWidth, container.clientHeight);
                vrRenderer.setClearColor(0x000000, 1);
                container.appendChild(vrRenderer.domElement);
                
                // Check if OrbitControls is available
                if (typeof THREE.OrbitControls === 'undefined') {
                    throw new Error('OrbitControls yüklenemedi');
                }
                
                // Create controls
                vrControls = new THREE.OrbitControls(vrCamera, vrRenderer.domElement);
                vrControls.enableZoom = true;
                vrControls.enablePan = false;
                vrControls.enableDamping = true;
                vrControls.dampingFactor = 0.05;
                vrControls.rotateSpeed = 0.5;
                vrControls.maxDistance = 2;
                vrControls.minDistance = 0.1;
                
                // Create multiple planes to simulate 360° effect
                create360Effect();
                
                // Position camera inside the scene
                vrCamera.position.set(0, 0, 0.1);
                
                // Handle window resize
                window.addEventListener('resize', onWindowResize);
                
                console.log('360° effect scene başarıyla oluşturuldu');
                
            } catch (error) {
                console.error('Three.js initialization error:', error);
                showVideoError('Three.js kütüphanesi yüklenirken hata oluştu: ' + error.message);
            }
        }

        function create360Effect() {
            // Create video texture
            videoTexture = new THREE.VideoTexture(videoElement);
            videoTexture.minFilter = THREE.LinearFilter;
            videoTexture.magFilter = THREE.LinearFilter;
            videoTexture.format = THREE.RGBFormat;
            
            // Create material
            videoMaterial = new THREE.MeshBasicMaterial({ map: videoTexture });
            
            // Create multiple planes to simulate 360° environment
            const planeGeometry = new THREE.PlaneGeometry(2, 1.2);
            
            // Front wall
            const frontWall = new THREE.Mesh(planeGeometry, videoMaterial);
            frontWall.position.set(0, 0, -1);
            vrScene.add(frontWall);
            
            // Back wall (same video, different position)
            const backWall = new THREE.Mesh(planeGeometry, videoMaterial);
            backWall.position.set(0, 0, 1);
            backWall.rotation.y = Math.PI;
            vrScene.add(backWall);
            
            // Left wall
            const leftWall = new THREE.Mesh(planeGeometry, videoMaterial);
            leftWall.position.set(-1, 0, 0);
            leftWall.rotation.y = Math.PI / 2;
            vrScene.add(leftWall);
            
            // Right wall
            const rightWall = new THREE.Mesh(planeGeometry, videoMaterial);
            rightWall.position.set(1, 0, 0);
            rightWall.rotation.y = -Math.PI / 2;
            vrScene.add(rightWall);
            
            // Ceiling
            const ceiling = new THREE.Mesh(planeGeometry, videoMaterial);
            ceiling.position.set(0, 0.6, 0);
            ceiling.rotation.x = -Math.PI / 2;
            vrScene.add(ceiling);
            
            // Floor
            const floor = new THREE.Mesh(planeGeometry, videoMaterial);
            floor.position.set(0, -0.6, 0);
            floor.rotation.x = Math.PI / 2;
            vrScene.add(floor);
            
            // Store references for cleanup
            sphereMesh = [frontWall, backWall, leftWall, rightWall, ceiling, floor];
        }

        function addVREventListeners() {
            // Video event listeners (if video element exists)
            if (videoElement) {
                videoElement.addEventListener('loadeddata', () => {
                    console.log('Video yüklendi:', videoElement.videoWidth + 'x' + videoElement.videoHeight);
                    
                    // Remove loading state
                    const loading = document.querySelector('.vr-loading');
                    if (loading) {
                        loading.remove();
                    }
                    
                    // Auto-play video
                    videoElement.play().then(() => {
                        isPlaying = true;
                        updatePlayPauseButton();
                        console.log('Video oynatılıyor');
                    }).catch(err => {
                        console.log('Auto-play prevented:', err);
                        // Manual play button will be available
                    });
                });
                
                videoElement.addEventListener('error', (e) => {
                    console.error('Video loading error:', e);
                    showVideoError('Video dosyası yüklenirken hata oluştu. ogretmenVR.mp4 dosyasının mevcut olduğundan emin olun.');
                });
                
                videoElement.addEventListener('loadstart', () => {
                    console.log('Video yüklenmeye başladı');
                });
                
                videoElement.addEventListener('canplay', () => {
                    console.log('Video oynatılmaya hazır');
                });
            }
        }

        // Handle VR key presses
        function handleVRKeyPress(event) {
            if (event.key === 'Escape') {
                // If in fullscreen, exit fullscreen first
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                } else {
                    // If not in fullscreen, hide VR experience
                    hideVRExperience();
                }
            }
        }

        // Hide VR experience
        function hideVRExperience() {
            // Exit fullscreen if active
            if (document.fullscreenElement) {
                document.exitFullscreen();
            }
            
            // Cleanup VR resources
            cleanupVR();
            
            // Remove key listener
            document.removeEventListener('keydown', handleVRKeyPress);
            
            // Navigate back to VR explore page
            showPage('vr-explore');
        }

        // Close VR experience (kept for backward compatibility)
        function closeVRExperience() {
            hideVRExperience();
        }

        function togglePlayPause() {
            try {
                // For YouTube videos, we need to control the iframe
                const iframe = document.querySelector('#vr-video-iframe iframe');
                if (iframe && iframe.src) {
                    // YouTube iframe API control
                    const iframeSrc = iframe.src;
                    if (isPlaying) {
                        // Pause video by removing autoplay parameter
                        iframe.src = iframeSrc.replace('autoplay=1', 'autoplay=0');
                        isPlaying = false;
                    } else {
                        // Play video by adding autoplay parameter
                        iframe.src = iframeSrc.replace('autoplay=0', 'autoplay=1');
                        isPlaying = true;
                    }
                    updatePlayPauseButton();
                } else if (videoElement && videoElement.play) {
                    // For local video files
                    if (isPlaying) {
                        videoElement.pause();
                        isPlaying = false;
                    } else {
                        videoElement.play().catch(err => {
                            console.log('Video play error:', err);
                        });
                        isPlaying = true;
                    }
                    updatePlayPauseButton();
                } else {
                    // Fallback: just toggle the button state
                    isPlaying = !isPlaying;
                    updatePlayPauseButton();
                    console.log('Video control not available, toggling button state only');
                }
            } catch (error) {
                console.error('Toggle play/pause error:', error);
                // Fallback: just toggle the button state
                isPlaying = !isPlaying;
                updatePlayPauseButton();
            }
        }

        function updatePlayPauseButton() {
            const btn = document.getElementById('play-pause-btn');
            const icon = btn.querySelector('i');
            
            if (isPlaying) {
                icon.className = 'fas fa-pause';
                btn.innerHTML = '<i class="fas fa-pause"></i> Duraklat';
            } else {
                icon.className = 'fas fa-play';
                btn.innerHTML = '<i class="fas fa-play"></i> Oynat';
            }
        }

        function toggleFullscreen() {
            const container = document.getElementById('vr-video-container');
            const controls = document.querySelector('.vr-controls');
            const instructions = document.querySelector('.vr-instructions');
            
            if (!document.fullscreenElement) {
                container.requestFullscreen().then(() => {
                    container.classList.add('fullscreen');
                    
                    // Hide controls and instructions in fullscreen
                    if (controls) controls.style.display = 'none';
                    if (instructions) instructions.style.display = 'none';
                    
                    onWindowResize();
                }).catch(err => {
                    console.log('Fullscreen error:', err);
                });
            } else {
                document.exitFullscreen().then(() => {
                    container.classList.remove('fullscreen');
                    
                    // Show controls and instructions when exiting fullscreen
                    if (controls) controls.style.display = 'flex';
                    if (instructions) instructions.style.display = 'block';
                    
                    onWindowResize();
                });
            }
        }

        function resetView() {
            vrCamera.position.set(0, 0, 0.1);
            vrCamera.rotation.set(0, 0, 0);
            vrControls.reset();
        }

        function onWindowResize() {
            const container = document.getElementById('vr-video-container');
            if (!container) return;
            
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            // Only resize Three.js components if they exist
            if (vrCamera && vrRenderer) {
                vrCamera.aspect = width / height;
                vrCamera.updateProjectionMatrix();
                vrRenderer.setSize(width, height);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            
            // Only update controls if they exist
            if (vrControls) {
                vrControls.update();
            }
            
            // Only render if all components exist
            if (vrRenderer && vrScene && vrCamera) {
                vrRenderer.render(vrScene, vrCamera);
            }
        }

        function showVideoError(message = 'Video yüklenirken hata oluştu') {
            const container = document.getElementById('vr-video-container');
            container.innerHTML = `
                <div class="vr-loading">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ff6b6b; margin-bottom: 15px;"></i>
                    <h4>VR Video Yüklenemedi</h4>
                    <p>${message}</p>
                    <div class="alert alert-warning mt-3" style="background: rgba(255, 193, 7, 0.2); border: 1px solid rgba(255, 193, 7, 0.5); color: var(--text-light);">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Olası Nedenler:</strong>
                        <ul class="mt-2 mb-0" style="text-align: left;">
                            <li>İnternet bağlantısı sorunu</li>
                            <li>YouTube video erişim kısıtlaması</li>
                            <li>Tarayıcı uyumluluk sorunu</li>
                        </ul>
                    </div>
                    <div class="mt-4">
                        <button class="btn btn-primary me-2" onclick="location.reload()">
                            <i class="fas fa-redo me-2"></i>Tekrar Dene
                        </button>
                        <button class="btn btn-outline-light" onclick="hideVRExperience()">
                            <i class="fas fa-arrow-left me-2"></i>Geri Dön
                        </button>
                    </div>
                </div>
            `;
        }

        // Cleanup VR resources when leaving page
        function cleanupVR() {
            // Cleanup YouTube iframe if exists
            const iframe = document.querySelector('#vr-video-iframe iframe');
            if (iframe) {
                iframe.src = '';
            }
            
            // Remove key listener
            document.removeEventListener('keydown', handleVRKeyPress);
            
            // Stop video if playing
            if (videoElement && !videoElement.paused) {
                videoElement.pause();
            }
            
            // Exit fullscreen if active
            if (document.fullscreenElement) {
                document.exitFullscreen();
            }
            
            // Cleanup Three.js resources if they exist
            if (vrRenderer) {
                vrRenderer.dispose();
                vrRenderer = null;
            }
            
            if (vrScene) {
                vrScene.clear();
                vrScene = null;
            }
            
            if (vrControls) {
                vrControls.dispose();
                vrControls = null;
            }
            
            console.log('VR resources cleaned up');
        }

        // Update showPage function to cleanup VR when leaving
        const originalShowPage = showPage;
        showPage = function(pageId) {
            // Cleanup VR if leaving VR simulation page
            if (document.getElementById('vr-simulation-page').classList.contains('active')) {
                cleanupVR();
            }
            
            // Call original function
            originalShowPage(pageId);
        };
    </script>
</body>
</html>
